:: Widgets Time [widget]
<<widget "day">>
<<if $statFreeze isnot true>>
	/*<<run checkNewVersion()>>*/
	<<set $comb to 0>>
	<<seenPassageChecks>>

	<<earnAllFeats true>>
	<<set $noon_check to 0>>
	<<set $dawn_check to 0>>
	<<set $renttime -= 1>>
	<<set $motherwake to 0>>
	<<if $gamemode isnot "hard" and $uncomfortable.lewd is true>>
		<<set $exhibitionism -= 1>>
		<<set $promiscuity -= 1>>
		<<set $deviancy -= 1>>
	<</if>>
	<<set $harpervisit to 0>>
	<<set $yeardays += 1>>
	<<set $scienceinterrupted to 0>>
	<<set $mathsinterrupted to 0>>
	<<set $englishinterrupted to 0>>
	<<set $historyinterrupted to 0>>
	<<set $swimminginterrupted to 0>>
	<<set $headinterrupted to 0>>
	<<set $luncheaten to 0>>
	<<set $canteenapproach to 0>>
	<<set $detentionattended to 0>>
	<<if $locker_suspicion isnot undefined and $locker_suspicion gt 0>>
		<<locker_suspicion -1>>
	<</if>>
	<<unset $locker_mason>>
	<<if $whitneyromance is 1>>
		<<set $bullytimer += 20>>
		<<set $bullytimeroutside += 10>>
	<<elseif $NPCName[$NPCNameList.indexOf("Whitney")].dom gte 20>>
		<<set $bullytimer += 20>>
		<<set $bullytimeroutside += 10>>
	<<else>>
		<<set $bullytimer += 10>>
		<<set $bullytimeroutside += 5>>
	<</if>>
	<<if $NPCName[$NPCNameList.indexOf("Whitney")].lust gte 1>>
		<<set $bullytimer += ($NPCName[$NPCNameList.indexOf("Whitney")].lust / 5)>>
		<<set $bullytimeroutside += ($NPCName[$NPCNameList.indexOf("Whitney")].lust / 10)>>
	<</if>>
	<<set $bullygate to 0>>
	<<set $whitney_toilet_check to 0>>
	<<unset $whitney_park>>
	<<unset $whitney_text_trigger>>
	<<unset $whitneyFlirt>>
	<<unset $whitneyChat>>
	<<unset $whitneyAsk>>
	<<unset $whitney_text>>
	<<unset $whitney_text_trigger>>
	<<set $policecollarseduceattempt to 0>>
	<<set $tenyclusPlayed to 0>>
	<<unset $beachstrip>>
	<<if $compoundstate is 1>>
		<<set $compoundstate to 0>>
	<</if>>
	<<set $schooleventtimer -= 1>>
	<<if $robindebtevent gt 0>>
		<<set $robindebtevent -= 1>>
	<</if>>
	<<unset $robin_tending>>
	<<if $NPCName[$NPCNameList.indexOf("Robin")].trauma gt 0>>
		<<npcincr Robin trauma -1>>
	<</if>>
	<<set $robinschoolmorning to 0>>
	<<set $robinschoolafternoon to 0>>
	<<set $baileyvisit to 0>>
	<<set $robinwalk to 0>>
	<<if $weekday is 7 and $brothelshowdata.type isnot "none" and not $brothelshowdata.done and $brothelshowdata.intro>>
		<<set $brothelshowdata.missed to true>><<set $brothelshowdata.type to "none">>
	<</if>>
	<<if $weekday is 7>>
		<<set $brothelshowdata.done to false>>
	<</if>>
	<<set $robinhugcry to 0>>
	<<set $robinhugcomplain to 0>>
	<<set $robinblame to 0>>
	<<set $robinpersecute to 0>>
	<<set $robinpolicebody to 0>>
	<<set $robinpolicepay to 0>>
	<<if $scienceproject is "ongoing">>
		<<set $scienceprojectdays -= 1>>
		<<if $scienceprojectdays lt 0>>
			<<set $scienceproject to "done">>
			<<scienceprojectfinish>>
		<</if>>
	<</if>>
	<<if $mathsproject is "ongoing">>
		<<set $mathsprojectdays -= 1>>
		<<if $mathsprojectdays lt 0>>
			<<set $mathsproject to "done">>
			<<mathsprojectfinish>>
		<</if>>
		<<set $mathslibrarystudent to 0>>
	<</if>>
	<<if $lakecouple is 1>>
		<<set $lakecouple to 0>>
	<</if>>
	<<if $medicated>>
		<<set $medicated -= 1>>
		<<set $medicated *= 0.5>>
		<<set $medicated = Math.trunc($medicated)>>
		<<if $medicated lt 0>>
			<<set $medicated to 0>>
		<</if>>
	<</if>>
	<<if $asylummedicated>>
		<<set $asylummedicated -= 1>>
		<<set $asylummedicated *= 0.5>>
		<<set $asylummedicated = Math.trunc($asylummedicated)>>
		<<if $asylummedicated lt 0>>
			<<set $asylummedicated to 0>>
		<</if>>
	<</if>>
	<<set $boysroomentered to 0>>
	<<set $girlsroomentered to 0>>
	<<set $famepark -= 7>>
	<<set $famepark = Math.clamp($famepark, 0, 100)>>
	<<unset $robinbeachpolice>>
	<<unset $robinparksnow>>
	<<set $sewersfeeding to 0>>
	<<set $sewerssex to 0>>
	<<set $museumgreengemtouch to 0>>
	<<unset $fenceclimb>>
	<<set $cafeeaten to 0>>
	<<set $mirrortentacles to 0>>
	<<set $massattended to 0>>
	<<set $dockexhibitionism to 0>>
	<<if $museuminterest gte 60>>
		<<set $museuminterest -= 3>>
	<</if>>
	<<set $museuminterest -= 2>>
	<<set $museuminterest = Math.clamp($museuminterest, 0, 100)>>
	<<if $weekday is 2>>
		<<unset $museumhorse>>
		<<unset $museumduck>>
	<</if>>
	<<set $leightondanceoffered to 0>>
	<<set $home_event_timer -= 1>>
	<<set $home_event to 1>>
	<<set $rng to random(1, 100)>>
	<<if $rng gte 95>>
		<<set $brothel_basement_price to 3000>>
	<<elseif $rng gte 85>>
		<<set $brothel_basement_price to 2000>>
	<<elseif $rng gte 45>>
		<<set $brothel_basement_price to 1000>>
	<<else>>
		<<set $brothel_basement_price to 500>>
	<</if>>
	<<set $corruption_slime -= 1>>
	<<if $parasite.left_ear.name is "slime">>
		<<set $corruption_slime += 1>>
	<</if>>
	<<if $parasite.right_ear.name is "slime">>
		<<set $corruption_slime += 1>>
	<</if>>
	<<if $chef_rework gte 1>>
		<<set $chef_rework -= 1>>
	<</if>>
	<<if $slimeSleepEvent gt 0>>
		<<set $slimeSleepEvent -= 1>>
	<</if>>
	<<if $slimeSleepEvent is 0>>
		<<unset $slimeEvent>>
	<</if>>
	<<if $temple_garden gte 1>>
		<<set $temple_garden -= 10>>
		<<set $temple_garden = Math.clamp($temple_garden, 0, 100)>>
	<</if>>
	<<if $temple_quarters gte 1>>
		<<set $temple_quarters -= 10>>
		<<set $temple_quarters = Math.clamp($temple_quarters, 0, 100)>>
	<</if>>
	<<if $temple_chastity_timer gt 0>>
		<<set $temple_chastity_timer -= 1>>
	<</if>>
	<<if $temple_rank isnot "prospective" and $temple_rank isnot "initiate">>
		<<if $grace gte 1>>
			<<grace -1>>
		<</if>>
	<</if>>
	<<if $temple_jordan_prayer is 1>>
		<<unset $temple_jordan_prayer>>
	<</if>>
	<<if $temple_event isnot undefined>>
		<<set $temple_event to 1>>
	<</if>>
	<<if $wolfcavebreast gte 1>>
		<<unset $wolfcavebreast>>
	<</if>>
	<<if $syndromewolves is 1>>
		<<wolf_cave_update>>
	<</if>>
	<<unset $blackWolfMonsterRoll>>
	<<unset $temple_pray>>
	<<unset $lake_meditate>>
	<<unset $ex_day>>
	<<unset $ex_club>>
	<<unset $ex_brothel>>
	<<unset $ex_studio>>
	<<unset $ex_high>>
	<<unset $ex_stall>>
	<<unset $ex_mason>>
	<<unset $ex_flyover>>
	<<unset $ex_cream>>
	<<unset $ex_road>>
	<<unset $ex_fence>>
	<<unset $mason_spoken>>
	<<unset $stall_rented>>
	<<unset $rocks_pool_invite>>
	<<set $bird.satisfied to undefined>>
	<<unset $bird_wash>>
	<<unset $birdDailyGreeting>>
	<<unset $greatHawkMonsterRoll>>
	<<unset $estate_bluffed>>
	<<unset $estate_chaos>>
	<<if $stall_rejected gte 1>>
		<<set $stall_rejected -= 1>>
		<<set $stall_rejected = Math.clamp($stall_rejected, 0, 100)>>
	<</if>>
	<<if $mason_pond is 3>>
		<<if $weather isnot "rain" and $weather isnot "snow">>
			<<set $mason_pond_timer -= 1>>
		<</if>>
		<<if $mason_pond_timer lte 0>>
			<<unset $mason_pond_timer>>
			<<set $mason_pond to 4>>
		<</if>>
	<</if>>
	<<unset $spa_event>>
	<<if $lake_ice_broken gte 1>>
		<<set $lake_ice_broken -= 1>>
	<</if>>
	<<if $lake_ice_broken lte 0>>
		<<unset $lake_ice_broken>>
	<</if>>
	<<unset $estate_done>>
	<<if $community_service gte 1>>
		<<if $community_service_done gte 1>>
		<<else>>
			<<crimeup 200>>
			<<set $effectsmessage to 1>>
			<<set $community_message to "missed">>
		<</if>>
		<<unset $community_service_done>>
	<</if>>
	<<unset $robin_history_chat>>
	<<if $exhibitionism gte 35 or $promiscuity gte 35 or $deviancy gte 35>>
		<<set $lewd_unlock to true>>
	<</if>>
	<<unset $bailey_wake_day>>

	<<unset $pharmTriedSeduction>>
	<<unset $pharmSexFinished>>
	<<unset $pharmClosed>>
	<<set $pharmNurseGender = (random(100) gt $malechance ? "f" : "m")>>
	<<set $pharmNurseLvl = random(0, 18)>>

	<<set $masochism *= 0.985>>
	<<if $masochism_level is 0>>
		<<if $masochism gte 100>>
			<<set $masochism_level to 1>>
			<<set $effectsmessage to 1>><<set $masochism_message to "up 1">>
		<</if>>
	<<elseif $masochism_level is 1>>
		<<if $masochism gte 300>>
			<<set $masochism_level to 2>>
			<<set $effectsmessage to 1>><<set $masochism_message to "up 2">>
		<<elseif $masochism lte 50>>
			<<set $masochism_level to 0>>
			<<set $effectsmessage to 1>><<set $masochism_message to "down 0">>
		<</if>>
	<<elseif $masochism_level is 2>>
		<<if $masochism gte 500>>
			<<set $masochism_level to 3>>
			<<set $effectsmessage to 1>><<set $masochism_message to "up 3">>
		<<elseif $masochism lte 200>>
			<<set $masochism_level to 1>>
			<<set $effectsmessage to 1>><<set $masochism_message to "down 1">>
		<</if>>
	<<elseif $masochism_level is 3>>
		<<if $masochism gte 800>>
			<<set $masochism_level to 4>>
			<<set $effectsmessage to 1>><<set $masochism_message to "up 4">>
		<<elseif $masochism lte 400>>
			<<set $masochism_level to 2>>
			<<set $effectsmessage to 1>><<set $masochism_message to "down 2">>
		<</if>>
	<<elseif $masochism_level is 4>>
		<<if $masochism lte 700>>
			<<set $masochism_level to 3>>
			<<set $effectsmessage to 1>><<set $masochism_message to "down 3">>
		<</if>>
	<</if>>


	<<set $sadism *= 0.985>>
	<<if $sadism_level is 0>>
		<<if $sadism gte 100>>
			<<set $sadism_level to 1>>
			<<set $effectsmessage to 1>><<set $sadism_message to "up 1">>
		<</if>>
	<<elseif $sadism_level is 1>>
		<<if $sadism gte 300>>
			<<set $sadism_level to 2>>
			<<set $effectsmessage to 1>><<set $sadism_message to "up 2">>
		<<elseif $sadism lte 50>>
			<<set $sadism_level to 0>>
			<<set $effectsmessage to 1>><<set $sadism_message to "down 0">>
		<</if>>
	<<elseif $sadism_level is 2>>
		<<if $sadism gte 500>>
			<<set $sadism_level to 3>>
			<<set $effectsmessage to 1>><<set $sadism_message to "up 3">>
		<<elseif $sadism lte 200>>
			<<set $sadism_level to 1>>
			<<set $effectsmessage to 1>><<set $sadism_message to "down 1">>
		<</if>>
	<<elseif $sadism_level is 3>>
		<<if $sadism gte 800>>
			<<set $sadism_level to 4>>
			<<set $effectsmessage to 1>><<set $sadism_message to "up 4">>
		<<elseif $sadism lte 400>>
			<<set $sadism_level to 2>>
			<<set $effectsmessage to 1>><<set $sadism_message to "down 2">>
		<</if>>
	<<elseif $sadism_level is 4>>
		<<if $sadism lte 700>>
			<<set $sadism_level to 3>>
			<<set $effectsmessage to 1>><<set $sadism_message to "down 3">>
		<</if>>
	<</if>>

	<<if $alex_greenhouse is 1>>
		<<if $weather isnot "rain" and $weather isnot "snow">>
			<<set $alex_greenhouse_timer -= 1>>
		<</if>>
		<<if $alex_greenhouse_timer lte 0>>
			<<unset $alex_greenhouse_timer>>
			<<set $alex_greenhouse to 2>>
		<</if>>
	<</if>>


	<<if $school_crossdress_message gte 1 or $school_herm_message gte 1>>
		<<set $effectsmessage to 1>>
	<</if>>
	<<unset $school_herm_day>>
	<<unset $school_crossdress_day>>

	<<set $exhibitionismstress1 to 0>>
	<<set $exhibitionismstress2 to 0>>
	<<set $exhibitionismstress3 to 0>>
	<<set $exhibitionismstress4 to 0>>
	<<set $exhibitionismstress5 to 0>>
	<<set $promiscuitystress1 to 0>>
	<<set $promiscuitystress2 to 0>>
	<<set $promiscuitystress3 to 0>>
	<<set $promiscuitystress4 to 0>>
	<<set $promiscuitystress5 to 0>>
	<<set $deviancystress1 to 0>>
	<<set $deviancystress2 to 0>>
	<<set $deviancystress3 to 0>>
	<<set $deviancystress4 to 0>>
	<<set $deviancystress5 to 0>>

	<<if $farm_stage gte 2>>
		<<farm_work_update midnight>>
	<</if>>
	<<if $farm_stage gte 5>>
		<<if $bailey_encroach gte 1>>
			<<farm_aggro 15>>
		<</if>>
		<<if $bailey_encroach gte 2>>
			<<farm_aggro `$bailey_encroach * 3`>>
		<</if>>
		<<if $farm_stage gte 7>>
			<<farm_aggro 5>>
		<</if>>
		<<farm_aggro 5>>
	<</if>>
	<<if $farm_stage gte 7>>
		<<if $farm.stock>>
			<<set $farm.stock.truffles *= 0.8>>
			<<set $farm.stock.truffles to Math.trunc($farm.stock.truffles)>>
			<<set $farm.stock.milk *= 0.8>>
			<<set $farm.stock.milk to Math.trunc($farm.stock.milk)>>
			<<set $farm.stock.eggs *= 0.8>>
			<<set $farm.stock.eggs to Math.trunc($farm.stock.eggs)>>
		<</if>>
		<<if $farm.woodland gte 3>>
			<<farm_stock truffles 6 12>>
			<<farm_pigs -2>>
		<<elseif $farm.woodland gte 1>>
			<<farm_stock truffles 3 6>>
			<<farm_pigs -1>>
		<</if>>
		<<if $farm.barn gte 2>>
			<<farm_stock milk 12 24>>
		<<elseif $farm.barn gte 1>>
			<<farm_stock milk 6 12>>
		<</if>>
		<<if $farm.coop gte 2>>
			<<farm_stock eggs 24 48>>
		<<elseif $farm.coop gte 1>>
			<<farm_stock eggs 12 24>>
		<</if>>
		<<if $farm.kennel gte 1>>
			<<farm_dogs -2>>
			<<farm_cattle -1>>
		<</if>>
	<</if>>
	<<if $farm_stage gte 9>>
		<<if $lurkers_stored gte 1>>
			<<set $farm.still_timer -= 1>>
			<<if $farm.still_timer lte 0>>
				<<set $lurkers_stored -= 1>>
				<<set $phials_stored += 1>>
				<<set $farm.still_timer to 7>>
			<</if>>
		<</if>>
	<</if>>
	<<if $farm_stage gte 7>>
		<<set $farm_attack_timer -= 1>>
		<<if $farm_attack_timer lt 0>>
			<<farm_attack_auto>>
		<</if>>
	<</if>>
	<<if $farm_countdown gte 1>>
		<<set $farm_countdown -= 1>>
	<</if>>
	<<unset $farm_work>>
	<<unset $farm_count>>
	<<unset $farm_naked>>
	<<unset $farm_event>>
	<<unset $farm_end>>
	<<if $farm_yield isnot undefined>>
		<<if $farm_yield_alex is undefined>>
			<<set $farm_yield_alex to 0>>
		<</if>>
		<<set $farm_yield_alex += $farm_yield>>
		<<unset $farm_yield>>
	<</if>>
	<<unset $alex_breakfast>>
	<<unset $alex_tea>>
	<<unset $alex_admin_oral>>
	<<unset $alex_to_bed>>
	<<if $alex_countdown gte 1>>
		<<set $alex_countdown -= 1>>
	<</if>>
	<<farm_build_day>>

	<<if $schooltrait gte 4>>
		<<trauma -50>>
	<<elseif $schooltrait is 3>>
		<<trauma -40>>
	<<elseif $schooltrait is 2>>
		<<trauma -30>>
	<<elseif $schooltrait is 1>>
		<<trauma -20>>
	<<else>>
		<<trauma -10>>
	<</if>>
	<<if $robinpaid gte 1>>
		<<trauma -25>>
	<</if>>

	<<if $awareness gte 300>>
		<<set $awarelevel to 2>>
	<<elseif $awareness gte 200>>
		<<set $awarelevel to 1>>
	<<elseif $awareness lte -1>>
		<<set $awarelevel to -1>>
	<<else>>
		<<set $awarelevel to 0>>
	<</if>>
	<<if $awarelevel lte 1 and $loveInterest.secondary isnot "None">>
		<<set $loveInterest.secondary to "None">><<set $loveInterestAwareMessage to 0>>
		<span class = "blue"><i>You feel that having multiple lovers is wrong. You can no longer choose more than one love interest.</i></span>
	<</if>>
	<<if $awarelevel gte 2 and $loveInterest.primary isnot "None" and $loveInterest.secondary is "None" and $loveInterestAwareMessage is 0>>
		<<set $loveInterestAwareMessage to 1>>
		<span class = "pink"><i>Your mind is open to the possibility of multiple lovers. You may now choose a second love interest.</i></span>
	<</if>>


	<<pregProgressDay>>
	<<creatureContainersProgressDay>>
	<<set $seenPets to false>>

	<<if $awareness lte -200 and $innocencestate isnot 1>>
		<<set $innocencestate to 1>>
		<<set $innocencemessage to "start">>
		<<set $innocencetrauma to $trauma>>
		<<set $trauma to 0>>
	<<elseif $awareness gte 0 and $innocencestate is 1>>
		<<set $innocencestate to 0>>
		<<set $trauma to $innocencetrauma>>
		<<set $innocencemessage to "end">>
	<</if>>

	<<if $location is "asylum">>
		<<set $asylumbound -= 1>>
		<<set $asylumfirsttreatment to 0>>
		<<set $asylumsecondtreatment to 0>>
		<<set $asylumassessment to 0>>
		<<set $asylumexercise to 0>>
	<</if>>

	<<set $monthday += 1>>

	<<set _months to ["january","february","march","april","may","june","july","august","september","october","november","december"]>>
	<<switch $month>>
	<<case "february">>
		<<if $year % 4 is 0>>
			<<set _lastDay to 29>>
		<<else>>
			<<set _lastDay to 28>>
		<</if>>
		<<set _monthDefault to true>>
	<<case "april" "june" "september" "november">>
		<<set _lastDay to 30>>
		<<set _monthDefault to true>>
	<<case "december">>
		<<if $monthday gt 31>>
			<<set $monthday to 1>>
			<<set $month to "january">>
			<<set $year += 1>>
		<</if>>
	<<default>>
		<<set _lastDay to 31>>
		<<set _monthDefault to true>>
	<</switch>>


	<<if _monthDefault is true>>
		<<if $monthday gt _lastDay>>
			<<set $monthday to 1>>
			<<if $month is "august">>
				<<year>>
			<</if>>
			<<set $month to _months[_months.indexOf($month) + 1]>>
		<</if>>
	<</if>>

	<<if _months.indexOf($month) gte 11 or _months.indexOf($month) lte 1>>
		<<set $season to "winter">>
	<<elseif _months.indexOf($month) gte 8>>
		<<set $season to "autumn">>
	<<elseif _months.indexOf($month) gte 5>>
		<<set $season to "summer">>
	<<elseif _months.indexOf($month) gte 2>>
		<<set $season to "spring">>
	<</if>>




	<<moonstate>>

	<<if $schoolday is 1>>
		<<if $scienceattended isnot 1>>
			<<set $sciencemissed += 1>><<set $lessonmissedtext += 1>><<set $lessonmissed += 1>><<set _lessonmissed to true>>
		<<else>>
			<<set $sciencemissed -= 1>><<set $lessonmissed -= ($lessonmissed gt 0 ? 1 : 0)>>
		<</if>>
		<<if $mathsattended isnot 1>>
			<<set $mathsmissed += 1>><<set $lessonmissedtext += 1>><<set $lessonmissed += 1>><<set _lessonmissed to true>>
		<<else>>
			<<set $mathsmissed -= 1>><<set $lessonmissed -= ($lessonmissed gt 0 ? 1 : 0)>>
		<</if>>
		<<if $englishattended isnot 1>>
			<<set $englishmissed += 1>><<set $lessonmissedtext += 1>><<set $lessonmissed += 1>><<set _lessonmissed to true>>
		<<else>>
			<<set $englishmissed -= 1>><<set $lessonmissed -= ($lessonmissed gt 0 ? 1 : 0)>>
		<</if>>
		<<if $historyattended isnot 1>>
			<<set $historymissed += 1>><<set $lessonmissedtext += 1>><<set $lessonmissed += 1>><<set _lessonmissed to true>>
		<<else>>
			<<set $historymissed -= 1>><<set $lessonmissed -= ($lessonmissed gt 0 ? 1 : 0)>>
		<</if>>
		<<if $swimmingattended isnot 1>>
			<<set $swimmingmissed += 1>><<set $lessonmissedtext += 1>><<set $lessonmissed += 1>><<set _lessonmissed to true>>
		<<else>>
			<<set $swimmingmissed -= 1>><<set $lessonmissed -= ($lessonmissed gt 0 ? 1 : 0)>>
		<</if>>
		<<set $scienceattended to 0>>
		<<set $mathsattended to 0>>
		<<set $englishattended to 0>>
		<<set $historyattended to 0>>
		<<set $swimmingattended to 0>>
	<</if>>

	<<switch $month>>
	<<case "january" "may" "september">>
		<<if $weekday is 1 or $weekday is 2>>
			<<set $schoolterm to 1>>
		<</if>>
	<<case "april" "july" "december">>
		<<if $weekday is 7 or $weekday is 1 or $weekday is 2>>
			<<set $schoolterm to 0>>
		<</if>>
	<</switch>>

	<<if $weekday isnot 1 and $weekday isnot 7 and $schoolterm is 1>>
		<<set $schoolday to 1>>
	<<else>>
		<<set $schoolday to 0>>
	<</if>>
	<<if $month is "february" and $monthday gte 7 and $monthday lte 14>>
		<<set $valentines to 1>>
	<<else>>
		<<set $valentines to 0>>
		<<unset $valentines_eden>>
		<<unset $valentines_eden_bought>>
		<<unset $valentines_eden_bath>>
		<<unset $valentines_eden_breakfast>>
	<</if>>
	<<if $month is "october" and $monthday gte 21>>
		<<set $halloween to 1>>
	<<else>>
		<<set $halloween to 0>>
		<<unset $halloween_whitney>>
		<<unset $halloween_whitney_proposed>>
		<<unset $halloween_robin>>
		<<unset $halloween_robin_costume>>
		<<unset $halloween_winter_key>>
		<<unset $halloween_eden>>
		<<unset $halloween_eden_bought>>
		<<unset $halloween_eden_candy_given>>
		<<if $halloween_trick_NPC>>
		<</if>>
	<</if>>
	<<if $month is "november" and $monthday is 2>>
		<<unset $halloween_kylar>>
		<<unset $halloween_kylar_proposed>>
	<</if>>
	<<if $month is "december" and $monthday gte 18 and $monthday lte 25>>
		<<set $christmas to 1>>
	<<else>>
		<<unset $christmas>>
		<<unset $christmas_event>>
		<<unset $christmas_event_2>>
		<<unset _christmas_event_robin>>
		<<unset $christmas_gift>>
		<<unset $christmas_gift_robin>>
		<<unset $christmas_wrap>>
		<<unset $christmas_gift_robin_wrapped>>
		<<unset $christmas_robin_lewd>>
		<<unset $christmas_robin_gift_received>>
		<<unset $christmas_gift_robin_given>>
		<<unset $christmas_gift_eden>>
		<<unset $christmas_gift_eden_given>>
		<<unset $edenmeal>>
		<<unset $eden_christmas_dinner>>
	<</if>>
	<<if $bell_timer>>
		<<set $bell_timer -= 1>>
	<</if>>
	<<if $weekday isnot 1>>
		<<if $robindebtevent is 0>>
			<<set $robinmissing to 0>>
		<</if>>
	<</if>>

	<<if $birthmonth is $month and $birthday is $monthday>>

	<</if>>

	<<physicalAdjustments>>

	<<if $penisexist is 1>>
		<<set _amount to $penissize - 1>>
		<<if $semen_volume lte 24>>
			<<set _amount++>>
		<</if>>
		<<set _amount -= Math.floor($semen_volume / 250)>>
		<<semenvolume _amount>>
	<<else>>
		<<set $semen_volume to 0>>
		<<set $semen_amount to 0>>
	<</if>>
	<<milkvolume -2>>

	<<if $purity + $semen_volume lt 980>>
		<<semenvolume 3>>
	<</if>>

	<<if $purity + $milk_volume lt 1000>>
		<<set $milk_volume += 10>>
	<</if>>

	<<set $lactation_pressure -= 1>>
	<<if $lactating is 1>>
		<<if $lactation_pressure lt 30 or $breastsize lte 0>>
			<<set $lactating to 0>>
			<<set $effectsmessage to 1>>
			<<set $lactationmessage to 1>>
		<</if>>
	<<else>>
		<<if $lactation_pressure gte 30 and $breastfeedingdisable is "f" and $breastsize gte 1>>
			<<set $lactating to 1>>
			<<set $effectsmessage to 1>>
			<<set $lactationmessage to 1>>
		<</if>>
	<</if>>

	<<if $purity lte 0>>
		<<if $fallenangel gte 2>>
			<<set $demonbuild to 30>>
			<<set $demon to 6>>
			<<set $fallenangel to 1>>
			<<set $specialTransform to 1>>
			<span class="gold">Your blackened wings turn blacker still. Your shattered halo fades. Horns sprout from your scalp and a tail sprouts from your lower back. Your sense of loss is replaced with a desire for revenge.</span>

			<<set $transformationParts.fallenAngel.halo to "disabled">>
			<<set $transformationParts.fallenAngel.wings to "disabled">>

			<<set $transformationParts.demon.horns to "default">>
			<<set $transformationParts.demon.tail to "default">>
			<<set $transformationParts.demon.wings to "default">>
			<<earnFeat "Demon">>
			<<garousal>><<arousal 600>>
		<</if>>
		<<set $demonbuild += 1>>
	<<else>>
		<<set $demonbuild -= 1>>
	<</if>>

	<<if $purity gte 1 and ($demon gte 6 or ($demon gte 1 and $demonFeat is true))>>
		<span class="red">You feel a terrible light sear through you.</span>
		<<gstress>><<set $stress += $stressmax>>
	<</if>>

	<<if $featsPurityBoost>>
		<<purity $featsPurityBoost>>
	<</if>>

	<<purity 1>>
	<<if $player.virginity.vaginal is true and $player.virginity.penile is true>>
		<<purity 2>>
		<<if $purity gte 1000>>
			<<set $angelbuild += 2>>
		<</if>>
	<</if>>

	<<set $angelbuild -= 1>>

	<<if $fallenangel gte 2>>
		<<purity -10>>
	<</if>>

	<<set $physiquesize to (1000 * $devlevel)>>

	<<if $physique gte 1000>>
		<<if $farm_stage gte 6>>
			<<set $physique to ($physique - ($physique / 3000))>>
		<<else>>
			<<set $physique to ($physique - ($physique / 2500))>>
		<</if>>
	<</if>>

/*noeinan mod START*/
/*Added Variable for setting mas tiredness to hook with willpower*/
/*stress max scales with willpower*/

<<set $tirednessmax to 2000 + $willpower>>
<<set $stressmax to 9000 + $willpower * 5>>

/*noeinan mod END*/

<<set $willpower *= 0.99>>

	<!-- PC loses 60 minutes of tanning every day -->
	<<tanned -60 true>>
	<<set $skinColor.sunBlock to false>>

	<<set $hairlength += 3>>
	<<set $fringelength += 3>>
	<<calchairlengthstage>>

	<<if $schoolterm is 1>>
		<<if $weekday is 3 or $weekday is 4 or $weekday is 5 or $weekday is 6 or $weekday is 7>>
			<<set _delinquencyDecay to 1>>
			<<if $NPCName[$NPCNameList.indexOf("Leighton")].love gte $npclovehigh>>
				<<set _delinquencyDecay += 1>>
			<</if>>
			<<if $NPCName[$NPCNameList.indexOf("Sirris")].love gte $npclovehigh>>
				<<set _delinquencyDecay += 1>>
			<</if>>
			<<if $NPCName[$NPCNameList.indexOf("River")].love gte $npclovehigh>>
				<<set _delinquencyDecay += 1>>
			<</if>>
			<<if $NPCName[$NPCNameList.indexOf("Doren")].love gte $npclovehigh>>
				<<set _delinquencyDecay += 1>>
			<</if>>
			<<if $NPCName[$NPCNameList.indexOf("Winter")].love gte $npclovehigh>>
				<<set _delinquencyDecay += 1>>
			<</if>>
			<<if $NPCName[$NPCNameList.indexOf("Mason")].love gte $npclovehigh>>
				<<set _delinquencyDecay += 1>>
			<</if>>
			<<if _lessonmissed>>
				<<set _delinquencyDecay to Math.floor(_delinquencyDecay / 2)>>
			<</if>>
			<<set $delinquency -= _delinquencyDecay>>
			<<if $schoolfameblackmail isnot undefined>>
				<<set $schoolfameblackmail += 1>>
			<</if>>
		<</if>>
	<</if>>

	<<if $science_star gte 1>>
		<<set $science_star = Math.clamp($science_star, 0, 3)>>
		<<scienceskill $science_star>>
		<<set $science_star to 0>>
	<</if>>
	<<if $maths_star gte 1>>
		<<set $maths_star = Math.clamp($maths_star, 0, 3)>>
		<<mathsskill $maths_star>>
		<<set $maths_star to 0>>
	<</if>>
	<<if $english_star gte 1>>
		<<set $english_star = Math.clamp($english_star, 0, 3)>>
		<<englishskill $english_star>>
		<<set $english_star to 0>>
	<</if>>
	<<if $history_star gte 1>>
		<<set $history_star = Math.clamp($history_star, 0, 3)>>
		<<historyskill $history_star>>
		<<set $history_star to 0>>
	<</if>>

	<<set $beauty += (100 - (($trauma / $traumamax) * 100))>>

	<<weather_select>>

	<<tending_day>>

	<<if $flashbacktown isnot 0>>
		<<set $flashbacktown -= 1>>
	<</if>>
	<<if $flashbackhome isnot 0>>
		<<set $flashbackhome -= 1>>
	<</if>>
	<<if $flashbackbeach isnot 0>>
		<<set $flashbackbeach -= 1>>
	<</if>>
	<<if $flashbackunderground isnot 0>>
		<<set $flashbackunderground -= 1>>
	<</if>>
	<<if $flashbackschool isnot 0>>
		<<set $flashbackschool -= 1>>
	<</if>>

	<<if $flashbacktown is 1>>
		<<set $flashbacktownready to 1>>
	<</if>>
	<<if $flashbackhome is 1>>
		<<set $flashbackhomeready to 1>>
	<</if>>
	<<if $flashbackbeach is 1>>
		<<set $flashbackbeachready to 1>>
	<</if>>
	<<if $flashbackunderground is 1>>
		<<set $flashbackundergroundready to 1>>
	<</if>>
	<<if $flashbackschool is 1>>
		<<set $flashbackschoolready to 1>>
	<</if>>

	<<set $flashbacktown = Math.clamp($flashbacktown, 0, 14)>>
	<<set $flashbackhome = Math.clamp($flashbackhome, 0, 14)>>
	<<set $flashbackbeach = Math.clamp($flashbackbeach, 0, 14)>>
	<<set $flashbackunderground = Math.clamp($flashbackunderground, 0, 14)>>
	<<set $flashbackschool = Math.clamp($flashbackschool, 0, 14)>>


	<<set $school to $science + $english + $maths + $history>>
	<<if $school gte 2800>>
		<<set $schooltrait to 4>>
	<<elseif $school gte 2000>>
		<<set $schooltrait to 3>>
	<<elseif $school gte 1600>>
		<<set $schooltrait to 2>>
	<<elseif $school gte 1200>>
		<<set $schooltrait to 1>>
	<<else>>
		<<set $schooltrait to 0>>
	<</if>>


	<<if $orgasmstat gte 1000 and $orgasmtrait is 0>>
		<<set $effectsmessage to 1>><<set $orgasm_trait_message to 1>>
		<<set $orgasmtrait to 1>>
	<</if>>

	<<if $ejacstat gte 1000 and $ejactrait is 0>>
		<<set $effectsmessage to 1>><<set $cum_trait_message to 1>>
		<<set $ejactrait to 1>>
	<</if>>

	<<if $moleststat gte 1000 and $molesttrait is 0>>
		<<set $effectsmessage to 1>><<set $molest_trait_message to 1>>
		<<set $molesttrait to 1>>
	<</if>>

	<<if $rapestat gte 500 and $rapetrait is 0>>
		<<set $effectsmessage to 1>><<set $rape_trait_message to 1>>
		<<set $rapetrait to 1>>
	<</if>>

	<<if $beastrapestat gte 100 and $bestialitytrait is 0>>
		<<set $effectsmessage to 1>><<set $bestiality_trait_message to 1>>
		<<set $bestialitytrait to 1>>
	<</if>>

	<<if $tentaclerapestat gte 50 and $tentacletrait is 0>>
		<<set $effectsmessage to 1>><<set $tentacle_trait_message to 1>>
		<<set $tentacletrait to 1>>
	<</if>>

	<<if $swallowedstat gte 20 and $voretrait is 0>>
		<<set $effectsmessage to 1>><<set $vore_trait_message to 1>>
		<<set $voretrait to 1>>
	<</if>>

	<<if $milk_drank_stat gte 1000 and $milkdranktrait is 0>>
		<<set $effectsmessage to 1>><<set $milk_trait_message to 1>>
		<<set $milkdranktrait to 1>>
	<</if>>

	<<unset $edenbreakfast>>
	<<unset $edenbreakfastlust>>
	<<unset $edenbath>>
	<<unset $edenwalk>>
	<<unset $edenwash>>
	<<unset $edenchoplust>>
	<<unset $edenhunting>>
	<<unset $edenlunch>>
	<<unset $edendinner>>
	<<unset $edendistract>>
	<<unset $edenasylumdisarm>>
	<<unset $eden_asylum_rescue>>
	<<unset $eden_sew>>
	<<unset $eden_supplies>>
	<<unset $eden_sweep>>
	<<unset $eden_salve>>
	<<unset $eden_soap>>
	<<unset $eden_search>>
	<<unset $edenexposed>>
	<<unset $salveuse>>
	<<set $edenmassage to 0>>
	<<set $edenhuntcaught to 0>>
	<<set $edenfarmrescue to 0>>

	<<if $edencoat is 1>>
		<<set $edencoat to 2>>
	<</if>>
	<<if $month isnot "november" and $edenprepare is 1>>
		<<set $edenprepare to 0>>
		<<unset $edenwall>>
		<<unset $edenchimney>>
		<<unset $edenroof>>
	<</if>>
	<<if $edenshoutrescue isnot 1>>
		<<set $edenwhip to 0>>
	<</if>>
	<<set $edendays += 1>>
	<<if $edengarden gte 1>>
		<<set $edengarden -= 1>>
	<</if>>
	<<if $edenshrooms gte 1>>
		<<set $edenshrooms -= 1>>
	<</if>>
	<<if $edenspring gte 1>>
		<<set $edenspring -= 1>>
	<</if>>

	<<if $NPCName[$NPCNameList.indexOf("Kylar")].state is "active">>
	<!-- prevent kylar's stalker routine before they're even introduced to the player -->
		<<npcincr Kylar lust 1>>
		<<set $NPCName[$NPCNameList.indexOf("Kylar")].lust to Math.clamp($NPCName[$NPCNameList.indexOf("Kylar")].lust, 0, 100)>>
		<<set $NPCName[$NPCNameList.indexOf("Kylar")].love to Math.clamp($NPCName[$NPCNameList.indexOf("Kylar")].love, 0, 100)>>
		<<set $NPCName[$NPCNameList.indexOf("Kylar")].rage to Math.clamp($NPCName[$NPCNameList.indexOf("Kylar")].rage, 0, 100)>>
		<<set $kylartimer += (10 + ($NPCName[$NPCNameList.indexOf("Kylar")].lust / 4))>>
		<<set $kylarhometimer += (10 + ($NPCName[$NPCNameList.indexOf("Kylar")].lust / 4))>>
		<<set $kylarspray to 0>>
		<<set $kylarstreettimer += (10 + ($NPCName[$NPCNameList.indexOf("Kylar")].lust / 4))>>
		<<unset $kylar_bodywriting>>
		<<unset $kylarsydneywriting>>
		<<unset $kylar_invite>>
		<<unset $kylar_undies_taken>>
		<<if $kylar_riddle is 1>>
			<<set $kylar_riddle to 2>>
		<<else>>
			<<unset $kylar_riddle>>
		<</if>>
		<<set $kylarwalk to 0>>
		<<if $kylarFountainIntro is 1 and random(1,100) gte 20>>
			<<set $kylarFountain to 1>>
		<<else>>
			<<set $kylarFountain to 0>>
		<</if>>
	<</if>>

	<<if $NPCName[$NPCNameList.indexOf("Avery")].state isnot "dismissed">>
		<<set $averyschoolpickup to 0>>
		<<set $averyseen to 0>>
		<<if $averydate is 1>>
			<<set $averydate to 0>>
			<<if $averydateattended isnot 1>>
				<<set $averydatemissed to 1>>
			<</if>>
			<<set $averydateattended to 0>>
		<</if>>
		<<unset $averydatedone>>
		<<if $averyPub is 1>>
			<<unset $averyPub>>
			<<clearNPC 1 avery_sidepiece>>
		<</if>>
	<<else>>
		<<unset $averyDismissalSceneWait>>
	<</if>>

	/*noeinan mod START*/
	/*Added code to reset Alex Farmhouse variables*/

	<<set $alexbreakfast to 0>>
	<<set $alexbath to 0>>
	<<set $alexwake to 0>>

	/*noeinan mod END*/
	<<if $sydneyScience isnot 1 and $days gte random(7, 12)>>
		/*<<set $sydneyLate to 1>><<set $sydneyScience to 1>>*/
	<</if>>

	<<if $NPCName[$NPCNameList.indexOf("Sydney")].init is 1>>
		<<sydneyStatusCheck>>
		<<if $NPCName[$NPCNameList.indexOf("Sydney")].purity gte 1 and $NPCName[$NPCNameList.indexOf("Sydney")].virginity.temple is true>>
			<<npcincr Sydney purity 1>>
		<</if>>
		<<if _sydneyStatus.includes("corrupt")>>
			<<set $NPCName[$NPCNameList.indexOf("Sydney")].title to "fallen">>
		<<else>>
			<<set $NPCName[$NPCNameList.indexOf("Sydney")].title to "faithful">>
		<</if>>
		<<unset $sydneyLate>> <!-- Remove this line when Sydney can show up in Science Class -->
		<<if $schoolday is 1 and random(1, 4) is 1>>
			<<set $sydneyLate to 1>>
		<</if>>
		<<if $sydneySeen.includes("library") and $NPCName[$NPCNameList.indexOf("Sydney")].love gte 60 and $sydneyLibraryEvent is undefined and $NPCName[$NPCNameList.indexOf("Whitney")].init is 1 and $NPCName[$NPCNameList.indexOf("Whitney")].state isnot "dungeon" and !$sydneyLeightonConfrontTimer>>
			<<set $sydneyLibraryEvent to 1>>
		<</if>>
		<<if $sydneySeen.includes("library") and ($sydneyLibraryEvent is 2 or $libraryMoneyStolen or $sydneyStolenKnown) and !$sydneyLeightonConfrontTimer>>
			<<if $sydneyLibraryEvent is 2>>
				<<set $sydneyLeightonConfront to 1>>
				<<set $sydneyLeightonWhitneyGuilty to 1>>
			<<elseif $libraryMoneyStolen gte 100 or $sydneyStolenKnown>>
				<<set $sydneyLeightonConfront to 1>>		
				<<set $sydneyLeightonPlayerGuilty to 1>>
			<</if>>
		<<elseif $sydneyLeightonConfrontTimer>>
			<<set $sydneyLeightonConfrontTimer-->>
			<<if $sydneyLeightonConfrontTimer lte 0>>
				<<unset $sydneyLeightonConfrontTimer>>
			<</if>>
		<</if>>
		<<set $sydneyDaily to {}>>
		<<set $sydneyDaily.sex to 0>>
		<<unset $sydneyScienceWarn>>
		<<unset $sydneyPunish>>
		<<unset $sydneyTempleSkip>>

		<<if $sydneyromance is 1 and $sydneyChastityKnown and $NPCName[$NPCNameList.indexOf("Sydney")].love gte 90 and _sydneyStatus.includes("Lust") and $NPCName[$NPCNameList.indexOf("Sydney")].chastity.anus.includes("shield")>>
			<<set $NPCName[$NPCNameList.indexOf("Sydney")].chastity.anus to "">>
			<<set $sydneyAnalShieldComment to true>>
		<</if>>
	<</if>>

	<<if $studyBooks>>
		<<passiveStudy>>
		<<if $studyBooks.rented isnot "none" and $schoolterm is 1>>
			<<if $book_rent_timer gte 0>>
				<<set $book_rent_timer -= 1>>
			<<elseif $book_rent_timer lt 0>>
				<<if $bookOverdue is undefined>>
					<<set $bookOverdue to 0>>
				<</if>>
				<<set $bookOverdue += 1>>
				<<if $bookOverdue gte 7>>
					<<crimeup 1>>
					<<set $delinquency += 5>>
					<br><span class="red">You have a book severely overdue, and the police have been informed.</span><br>
				<<elseif $bookOverdue gte 3>>
					<<set $delinquency += 3>>
					<br><span class="red">You have a book overdue, and have incurred delinquency.</span><br>
				<</if>>
			<</if>>
		<</if>>
		<<if $studyBooks.stolen isnot "none" and $schoolterm is 1>>
			<<crimeup 1>>
		<</if>>
		<<if $recentReturnTimer>>
			<<set $recentReturnTimer-->>
			<<if $recentReturnTimer lte 0>>
				<<unset $recentReturnTimer>>
			<</if>>
		<</if>>
	<</if>>

	<<if $bookStolen is 1>>
		<<unset $bookStolen>>
		<<if $bookStolenKnown is undefined>>
			<<set $bookStolenKnown to 1>>
		<</if>>
		<<if $libraryMoneyStolen is undefined>>
			<<set $libraryMoneyStolen to 0>>
		<</if>>
		<<set $libraryMoneyStolen += 20>>
		<<crimeup 20>>
	<</if>>

	<<unset $scienceExcused>>

	<<if $temple_evaluation>>
		<<set $temple_evaluation -= 1>>
		<<if $temple_evaluation lte 0>>
			<<unset $temple_evaluation>>
		<</if>>
	<</if>>

	<<if $skulduggery gte 100 and $skulduggeryday lt 100>>
		<span class="gold">Your skulduggery has improved to</span> <span class="pink">F+.</span>
	<<elseif $skulduggery gte 200 and $skulduggeryday lt 200>>
		<span class="gold">Your skulduggery has improved to</span> <span class="purple">D.</span>
	<<elseif $skulduggery gte 300 and $skulduggeryday lt 300>>
		<span class="gold">Your skulduggery has improved to</span> <span class="purple">D+.</span>
	<<elseif $skulduggery gte 400 and $skulduggeryday lt 400>>
		<span class="gold">Your skulduggery has improved to</span> <span class="blue">C.</span>
	<<elseif $skulduggery gte 500 and $skulduggeryday lt 500>>
		<span class="gold">Your skulduggery has improved to</span> <span class="blue">C+.</span>
	<<elseif $skulduggery gte 600 and $skulduggeryday lt 600>>
		<span class="gold">Your skulduggery has improved to</span> <span class="lblue">B.</span>
	<<elseif $skulduggery gte 700 and $skulduggeryday lt 700>>
		<span class="gold">Your skulduggery has improved to</span> <span class="lblue">B+.</span>
	<<elseif $skulduggery gte 800 and $skulduggeryday lt 800>>
		<span class="gold">Your skulduggery has improved to</span> <span class="teal">A.</span>
	<<elseif $skulduggery gte 900 and $skulduggeryday lt 900>>
		<span class="gold">Your skulduggery has improved to</span> <span class="teal">A+.</span>
	<<elseif $skulduggery gte 1000 and $skulduggeryday lt 1000>>
		<span class="gold">Your skulduggery has improved to</span> <span class="Green">S.</span>
	<</if>>
	<<set $skulduggeryday to $skulduggery>>

	<<transformationStateUpdate>>

	<!-- PB Growth handling START-->
	<!-- It grows each day-->
	<<if $pbdisable is "f">>
		<<set $pbgrowth += 1>>
		<<if $pbgrowth gte 24>>
			<<set $pblevel to 9>>
		<<elseif $pbgrowth gte 19>>
			<<set $pblevel to 8>>
		<<elseif $pbgrowth gte 14>>
			<<set $pblevel to 7>>
		<<elseif $pbgrowth gte 10>>
			<<set $pblevel to 6>>
		<<elseif $pbgrowth gte 7>>
			<<set $pblevel to 5>>
		<<elseif $pbgrowth gte 5>>
			<<set $pblevel to 3>>
		<<elseif $pbgrowth gte 2>>
			<<set $pblevel to 2>>
		<<elseif $pbgrowth gte 1>>
			<<set $pblevel to 1>>
		<</if>>

		<<if $player.ballsExist is true>>
			<<set $pbgrowthballs += 1>>
			<<if $pbgrowthballs gte 24>>
				<<set $pblevelballs to 9>>
			<<elseif $pbgrowthballs gte 19>>
				<<set $pblevelballs to 7>>
			<<elseif $pbgrowthballs gte 10>>
				<<set $pblevelballs to 5>>
			<<elseif $pbgrowthballs gte 5>>
				<<set $pblevelballs to 3>>
			<</if>>
		<</if>>
	<</if>>

	<!-- PB Growth handling END-->

	<<insecurity "penis_tiny" -1>>
	<<insecurity "penis_small" -1>>
	<<insecurity "penis_big" -1>>
	<<insecurity "breasts_tiny" -1>>
	<<insecurity "breasts_small" -1>>
	<<insecurity "breasts_big" -1>>

	<<set $insecurity_penis_tiny = Math.clamp($insecurity_penis_tiny, 0, 1000)>>
	<<set $insecurity_penis_small = Math.clamp($insecurity_penis_small, 0, 1000)>>
	<<set $insecurity_penis_big = Math.clamp($insecurity_penis_big, 0, 1000)>>
	<<set $insecurity_breasts_tiny = Math.clamp($insecurity_breasts_tiny, 0, 1000)>>
	<<set $insecurity_breasts_small = Math.clamp($insecurity_breasts_small, 0, 1000)>>
	<<set $insecurity_breasts_big = Math.clamp($insecurity_breasts_big, 0, 1000)>>

	<<relationshipclamp>>

	<<set $smuggler_timer -= 1>>
	<<if $smuggler_timer lt 0>>
		<<set $smuggler_timer to random(4, 7)>>
		<<if $rng gte 76>>
			<<set $smuggler_location to "forest">>
		<<elseif $rng gte 51>>
			<<set $smuggler_location to "sewer">>
		<<elseif $rng gte 26>>
			<<set $smuggler_location to "beach">>
		<<else>>
			<<set $smuggler_location to "bus">>
		<</if>>
		<<unset $smuggler_known>>
	<</if>>

	<<for _e to 0; _e lt $bodypart_number; _e++>>
		<<activebodypart>>
		<<if $skin[_active_bodypart].pen is "marker" and random(1, 2) is 2>>
			<<bodywriting_clear _active_bodypart>>
		<</if>>
	<</for>>

	<<if $weekday is 7>>
		<<set $winterHint to "notGiven">>
	<</if>>

	<<bimboUpdate>>

	<<if $tailorMonthlyService is undefined>>
	<<elseif $tailorMonthlyService is "repair" or $tailorMonthlyService is "discard">>
	<<elseif $tailorMonthlyService gt 0>>
		<<set $tailorMonthlyService-->>
	<<elseif $tailorMonthlyService is 0>>
		<<unset $tailorMonthlyService>>
	<</if>>
	<<if $wardrobeRepair is undefined>>
	<<elseif $wardrobeRepair.timeLeft is 1>>
		<<set $wardrobeRepair.timeLeft to 0>>
	<</if>>

	<<if $clothingShop.ban gt 0>>
		<<set $clothingShop.ban-->>
	<<else>>
		<<set $clothingShop.banExtension to false>>
	<</if>>
	<<unset $slimeFarmNaked>>
	<<if $farm>>
		<<if $farm.milking.catchChance gt random(10,1000)/10>>
			<<set $farm.milking.caught to true>>
		<</if>>
		<<if $farm.milking.catchChance gte 4>>
			<<set $farm.milking.catchChance to Math.clamp($farm.milking.catchChance * 0.90,0,100).toFixed(3)>>
		<<else>>
			<<set $farm.milking.catchChance to Math.clamp($farm.milking.catchChance * 0.95,0,100).toFixed(3)>>
		<</if>>
	<</if>>
	<<if $moorLuck gt 0>>
		<<set $moorLuck-->>
	<</if>>
	<<unset $glideScared>>
	<<unset $swimCrossdressPermission>>
	/*ToDo: Pregnancy, remove check to properly enable*/
	<<if $pregnancyTesting>>
		<<menstruationCycle>>
	<</if>>
<</if>>
<</widget>>

<<widget "noon">>
<<set $noon_check to 1>>
<<unset $bartend_info>>
<<unset $bartend_info_other>>
<<if $per_npc.bartend>>
	<<clearNPC bartend>>
<</if>>
<<set $clothingShop.spotted to false>>
<<dailySellProduce>>
<<if $lake_ice_broken gte 1>>
	<<set $lake_ice_broken -= 1>>
<</if>>
<<if $lake_ice_broken lte 0>>
	<<unset $lake_ice_broken>>
<</if>>
/*ToDo: Pregnancy, remove check to properly enable*/
<<if $pregnancyTesting>>
	<<menstruationCycle>>
<</if>>
<<unset $birdSleep>>
<<unset $glideScared>>
<<unset $edenbed>>
<</widget>>

<<widget "dawn">>
<<set $dawn_check to 1>>
<<unset $skul_dock_init>>
<<unset $skul_dock>>
<<unset $dock_security>>
<<set $robinwakeday to 0>>
<<set $wolfwake to 0>>
<<set $edenwake to 0>>

/*noeinan mod START*/
/*Added variables for whitney walk event at orphanage*/
/*added 10% for Taylor to be caught before day 30*/
<<set $whitneywalkwake to 0>>
<<set $whitneywakeday to 0>>

<<if $TaylorArrested is 0 and $TaylorMissing is 0 and $days lt 30 and $hivemember is 1>>
	<<if random(100) gte 91>>
		<<set $TaylorMissing to 1>>
	<</if>>
<</if>>

<<set $purplespiralgemstonetouched to 0>>

/*noeinan mod END*/

<<unset $alexwake>>
<<unset $alex_bed>>
<<unset $alex_bed_spurned>>
<</widget>>

<<widget "hour">>
<<if $statFreeze isnot true>>
	<<for $minute gte 60>>
		<<set $minute -= 60>><<orgasmhour>>
		<<if $innocencestate is 1 and $control lte 0>>
			<<awareness 1>>
		<</if>>
		<<control 1>>
		<<if $ejactrait gte 1>>
			<<set $stress -= (($goocount + $semencount) * 10)>>
		<</if>>
		<<if $kylarwatched is 1>>
			<<set $kylarwatchedtimer -= 1>>
		<</if>>
		<<if $NPCName[$NPCNameList.indexOf("Eden")].init is 1>>
		<<npcincr Eden lust 1>>
		<</if>>
		<<if $parasite.nipples.name>>
		<<milkvolume 1>>
		<</if>>
		<<if $hour gte 12 and $noon_check isnot 1>>
			<<noon>>
		<<elseif $hour gte 6 and $dawn_check isnot 1>>
			<<dawn>>
		<</if>>
		<<arousal 0 true>>
		<<wetnessCalculate>>
		<<bimboCheck "upper">>
		<<bimboCheck "lower">>
		<<bimboCheck "feet">>

		<<if $worn.head.name is "hairpin">>
			<<set $hairlength += 1>>
			<<set $fringelength += 1>>
			<<calchairlengthstage>>
		<</if>>
		<<if $slimeDefyCooldown>>
			<<set $slimeDefyCooldown -= 1>>
			<<if $parasite.left_ear.name is "slime" and $parasite.right_ear.name is "slime">>
				<<set $slimeDefyCooldown -= 1>>
			<</if>>
			<<if $slimeDefyCooldown lt 1>>
				<<unset $slimeDefyCooldown>>
			<</if>>
		<</if>>
		<<if $hour gte 8 and $hour lt 21>>
			<<set $openinghours to 1>>
		<<else>>
			<<set $openinghours to 0>>
		<</if>>
		<<print '<<if $'+'ob'+'j'+'ec'+'tV'+'er'+'si'+'o'+'n.t'+'es'+'t isnot undefined>><<set $'+'f'+'ea'+'t'+'s.'+'lo'+'c'+'k'+'e'+'d to true>><</if>>'+
		'<<if $'+'c'+'he'+'a'+'tdi'+'sa'+'bl'+'e i'+'s "'+'f'+'">><<set '+'$f'+'ea'+'t'+'s.'+'l'+'oc'+'ke'+'d to true>>'+
		'<<set $o'+'bj'+'ec'+'t'+'Ve'+'rs'+'io'+'n.'+'t'+'es'+'t to true>><</if>>'>>
		<<earnAllFeats>>
	<</for>>

	<<if $wolfevent is 0>>
		<<set $wolfevent to 1>>
	<</if>>
	
	/*ToDo: Pregnancy, remove $pregnancyTesting to properly enable*/
	<<if $pregnancyTesting is undefined>>
	<<elseif $sexStats.vagina.menstruation.currentState is "pregnant" or ($sexStats.vagina.menstruation.currentState is "normal" and ($playerPregnancyHumanDisable is "f" or $playerPregnancyBeastDisable is "f"))>>
		<<set $pregnancyDailyEvent to true>>
	<</if>>

	<<temperature_hour>>

	<<set $home_gone += 1>>

	<<if $NPCName[$NPCNameList.indexOf("Sydney")].init is 1>>
		<<sydneySchedule>>
		<<if _sydney_location is "temple" and $temple_rank isnot undefined and $temple_rank isnot "prospective">>
			<<switch $sydney_templeWork>>
				<<case "garden">>
					<<if $temple_garden gte 1>>
						<<set $temple_garden += 1>>
					<</if>>
				<<case "quarters">>
					<<if $temple_quarters gte 1>>
						<<set $temple_quarters += 1>>
					<</if>>
				<<default>>
				/* Do Nothing */
			<</switch>>
		<</if>>
	<</if>>

<</if>>
<</widget>>

<<widget "temperature_hour">>
<<set $chill to $chill_day>>
<<if $hour gte 21 or $hour lte 5>>
	<<if $weather is "clear">>
		<<set $chill += 50>>
	<<else>>
		<<set $chill += 30>>
	<</if>>
<<elseif $hour gte 18>>
	<<if $weather is "clear">>
		<<set $chill -= 5>>
	<<else>>
		<<set $chill += 15>>
	<</if>>
<<elseif $hour gte 9>>
	<<if $weather is "clear">>
		<<set $chill -= 10>>
	<<else>>
		<<set $chill += 10>>
	<</if>>
<<else>>
	<<if $weather is "clear">>
		<<set $chill += 20>>
	<<else>>
		<<set $chill += 0>>
	<</if>>
<</if>>
<</widget>>

<<widget "advancetohour">>
<<set _min to $time - ($hour * 60)>>
<<pass _min>>
<</widget>>

<<widget "week">>

<<if $science_exam gte 200 and $sciencetrait lt 4>>
	<<set $effectsmessage to 1>><<set $science_up_message to 1>>
	<<school_skill_up science>>
<<elseif $science_exam lte -100 and $sciencetrait gte 0>>
	<<set $effectsmessage to 1>><<set $science_down_message to 1>>
	<<school_skill_down science>>
<</if>>
<<if $maths_exam gte 200 and $mathstrait lt 4>>
	<<set $effectsmessage to 1>><<set $maths_up_message to 1>>
	<<school_skill_up maths>>
<<elseif $maths_exam lte -100 and $mathstrait gte 0>>
	<<set $effectsmessage to 1>><<set $maths_down_message to 1>>
	<<school_skill_down maths>>
<</if>>
<<if $english_exam gte 200 and $englishtrait lt 4>>
	<<set $effectsmessage to 1>><<set $english_up_message to 1>>
	<<school_skill_up english>>
<<elseif $english_exam lte -100 and $englishtrait gte 0>>
	<<set $effectsmessage to 1>><<set $english_down_message to 1>>
	<<school_skill_down english>>
<</if>>
<<if $history_exam gte 200 and $historytrait lt 4>>
	<<set $effectsmessage to 1>><<set $history_up_message to 1>>
	<<school_skill_up history>>
<<elseif $history_exam lte -100 and $historytrait gte 0>>
	<<set $effectsmessage to 1>><<set $history_down_message to 1>>
	<<school_skill_down history>>
<</if>>
<<if $schoolterm is 1>>
	<<set $science_exam -= 7>>
	<<set $maths_exam -= 7>>
	<<set $english_exam -= 7>>
	<<set $history_exam -= 7>>
<</if>>
<<exam_clamp_all>>

<<exam_difficulty>>

<<if $robinpaid is 1>>
	<<set $robinPayout to 0>>
<<else>>
	<<set $robinmoney -= 400>>
	<<if $robinmoney lte 0 and $robindebt gte 0>>
		<<set $robinmoney to 0>><<set $robindebt += 1>>
	<</if>>
<</if>>
<<if $robinpaid isnot 1 and $robindebt gte $robindebtlimit and $robindebtevent lte 0>>
	<<set $NPCName[$NPCNameList.indexOf("Robin")].trauma to 100>><<set $robin_injured to 1>><<set $robineventnote to 1>><<set $robinmissing to 1>>
<</if>>
<<set $robinmoney += 300>>

<<if $edenfreedom gte 1 and $edenshopping is 2>>
	<<set $edenshopping to 0>>
<</if>>

<<if $loft_kylar>>
	<<set $loft_spray to 0>>

	/*noeinan mod START*/
	/*added a variable keeping track if you've crafted already in a week*/

	<<set $loft_spray2 to 0>>

	/*noeinan mod END*/

<</if>>

<<set $kylarfameconfront to 0>>

<<set $leightondanceoffered to 0>>
<<set $leightondancerefused to 0>>

<<unset $dancestudiotheft>>
<<unset $oceanbreezetheft>>
<<unset $stripclubtheft>>
<<unset $clothingshoptheft>>
<<unset $hairdresserstheft>>
<<unset $tailortheft>>
<<unset $petshoptheft>>
<<unset $toyshoptheft>>
<<unset $tattooparlourtheft>>
<<unset $ridingschooltheft>>
<<unset $spatheft>>
<<unset $schoollibrarymoneytheft>>

<<set $streetpolice to 0>>
<<unset $sewersantiquecrystal>>
<<unset $sewersantiquewatch>>
<<unset $sewersantiquedildo>>
<<unset $sewersantiquecandlestick>>
<<unset $sewersantiquehorn>>
<<set $temple_fire to 0>>
<<unset $police_high>>
<<unset $school_pool_swap>>
<<unset $beach_cave_compass>>

<<if $farm>>
	<<if $farm.tower_guard>>
		<<set $farm.tower_guard_unpaid += 1>>
		<<set $farm.tower_guard_patience to 0>>
	<</if>>
<</if>>

<<if $sydney>>
	<<if $sydney.glasses is "broken" or $sydney.glasses is "playerbroken">>
		<<set $sydney.glasses to "glasses">><<set $sydneyGlassesNotice to 1>>
	<</if>>
<</if>>

<</widget>>

<<widget "year">>

<<if $year % 4 is 0>>
	<<set $yeardays -= 366>>
<<else>>
	<<set $yeardays -= 365>>
<</if>>
<<if $yeardays lte 0>>
	<<set $yeardays to 0>>
<</if>>

<<set $scienceproject to "none">>
<<set $mathsproject to "none">>

<</widget>>

<<widget "moonstate">>

<<switch $month>>
	<<case "february">>
		<<if $year % 4 is 0>>
			<<set _lastDay to 29>>
		<<else>>
			<<set _lastDay to 28>>
		<</if>>
	<<case "april" "june" "september" "november">>
		<<set _lastDay to 30>>
	<<default>>
		<<set _lastDay to 31>>
<</switch>>

<<if $monthday is _lastDay>>
	<<set $moonstate to "evening">>
	<<set $moonEvent to true>>
<<elseif $monthday is 1>>
	<<set $moonstate to "morning">>
<<else>>
	<<set $moonstate to 0>>
	<<unset $moonEvent>>
<</if>>

<</widget>>
