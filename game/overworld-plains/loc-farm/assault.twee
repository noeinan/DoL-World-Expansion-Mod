:: Farm Assault
<<set $outside to 1>><<set $location to "alex_farm">><<effects>>
<<farm_work_update>>
<<if $farm_assault.movement is "field">>
    You keep low as you hurry across the farm.
<<elseif $farm_assault.movement is "tower">>
    You keep low as you hurry towards the watchtower.
<<elseif $farm_assault.movement is "climb">>
    You enter the watchtower. The stairs creak as you climb.
<<elseif $farm_assault.movement is "wait">>
    You wait in the shadows, watching for intruders.
<<elseif $farm_assault.movement is "struggle">>
    <<if $farm_assault.bindings lte 0>>
        You struggle against your bindings. <span class="green">They come loose.</span> You tear the gag from your mouth.
        <<if $farm_assault.alex is "bound">>
            <<npc Alex>><<person1>>
            You find Alex not far away, remove the gag from <<his>> mouth, and untie <<his>> bonds. "Fuckers," <<he>> says. "There's no time to waste."
            <<set $farm_assault.bindings_alex to 0>>
            <<set $farm_assault.alex to "patrol">>
            <<endevent>>
        <</if>>
        <<farm_assault_unbind>>
    <<else>>
        You struggle against your bindings. <span class="teal">They feel a little looser.</span>
    <</if>>
<</if>>
<<set $farm_assault.movement to "none">>
<br><br>

<<farm_assault_progress>>

<<farm_assault_alex>>

<<if _smoke>>
    <span class="red">You smell smoke on the breeze.</span>
    <br><br>
<</if>>

<<if $farm_assault.tower is "manned" or $farm_assault.tower is "attacked" or _guard_won is true or _guard_lost is true>>
    <<farm_assault_info guard>>
<<elseif $farm_assault.tower is "defeated">>
    <span class="red">$farm.tower_guard has been defeated, and can't help for the remainder of the assault.</span>
    <br><br>
<</if>>

<<if $bus is "tower_top">>
    <<farm_assault_info>>
<</if>>

<<if _dogs_status is "victorious">>
    <span class="green">You hear a triumphant howling.</span>
    <br><br>
<<elseif _dogs_status is "defeated">>
    <span class="red">You hear a panicked howling.</span>
    <br><br>
<</if>>

<<if $farm_destroyed is true>>
    <<farm_assault_unbind>>
    <<if $fields_damaged is 0>>
        <span class="purple">With no fields to burn, the thugs flee the field.</span><<lcontrol>><<gtrauma>><<control -10>><<trauma 6>>
        <br><br>
        <<npc Remy>><<person1>>
        Remy watches from a nearby hill. <<He>> turns <<his>> steed and rides away.
        <br><br>
        <<endevent>>
        <<link [[Next|Farm Assault Victory]]>><</link>>
        <br>
    <<else>>
        <span class="red">Their job done, the thugs flee the fields, leaving a smoldering waste behind them.</span>
        <<lllcontrol>><<gggtrauma>><<control -50>><<trauma 24>>
        <br><br>
        <<npc Remy>><<person1>>
        Remy watches from a nearby hill. <<He>> turns <<his>> steed and rides away.
        <br><br>
        <<endevent>>
        <<link [[Next|Farm Assault Defeat]]>><</link>>
        <br>
    <</if>>
<<elseif _farm_assault_active isnot true>>
    <<farm_assault_unbind>>
    <span class="green">Driven back, the thugs flee the farm.</span>
    <<if $fields_damaged gte 2>>
        <span class="pink">They managed to torch $fields_damaged fields.</span><<llcontrol>><<ggtrauma>><<control -25>><<trauma 12>>
    <<elseif $fields_damaged gte 1>>
        <span class="blue">They managed to torch a field.</span><<lcontrol>><<gtrauma>><<control -10>><<trauma 6>>
    <<else>>
        <span class="green">They failed to torch a single field.</span><<ggcontrol>><<lltrauma>><<control 25>><<trauma -25>>
        <<if $farm_stage gte 12>>
            <<earnFeat "Heroic Victory">>
        <</if>>
    <</if>>
    <br><br>
    <<npc Remy>><<person1>>
    Remy watches from a nearby hill. <<He>> turns <<his>> steed and rides away.
    <br><br>
    <<endevent>>
    <<link [[Next|Farm Assault Victory]]>><</link>>
    <br>
<<else>>

    <<farm_assault_actions>>
    
<</if>>


:: Farm Assault Defeat
<<effects>>

<<npc Alex>><<person1>>
You find Alex lying on <<his>> face, an empty bottle beside <<him>>. <<Hes>> unconscious.<<llldom>><<npcincr Alex dom -15>>
<br><br>

<<if $farm_assault.tower is "defeated">>
    You carry <<him>> back to the cottage, and lay <<him>> in <<his>> bed, before returning to search for $farm.tower_guard.
    <<endevent>>
    <<loadNPC 0 "farm_tower_guard">><<person1>>
    You find <<him>> sitting at the base of the watchtower,
    <<if $NPCList[0].traits.includes("relaxed")>>
       trying to light a cigarette butt. "That was rougher than I expected," <<he>> says. "Could you help me up?"
    <<elseif $NPCList[0].traits.includes("sociable")>>
        chatting on <<his>> phone. "-boss is here. Call you back." <<He>> smiles at you. "You should have seen how many I took on before they got me."
    <<elseif $NPCList[0].traits.includes("brooding")>>
        gazing at the sky. "Sorry kid," <<he>> says. "I like to think I gave as good as I got."
    <<else>>
        watching you. "Are you an angel come to take me away?" <<he>> laughs. 
    <</if>>
    You help <<him>> to <<his>> feet.
    <<if $NPCList[0].traits.includes("relaxed")>>
       "I'll be alright" <<he>> continues. "Just need to stretch."
    <<elseif $NPCList[0].traits.includes("sociable")>>
        "There's a stool just inside," <<he>> continues. "A little rest would do me good."
    <<elseif $NPCList[0].traits.includes("brooding")>>
        "Don't worry about me," <<he>> continues. "I'll walk it off."
    <<else>>
        "Your touch has me feeling better already," <<he>> continues. "I think I can limp back to my post."
    <</if>>
    <br><br>
    You return to the cottage. Remy won this round, but the war continues.
    <br><br>
<<elseif $farm_assault.tower is "manned" or $farm_assault.tower is "attacked">>
    $farm.tower_guard limps over. 
    
    <<endevent>>
    <<loadNPC 0 "farm_tower_guard">><<person1>>

    <<if $NPCList[0].traits.includes("relaxed")>>
       "Let's get <<nnpc_him Alex>> inside," <<he>> says, nodding at Alex. "Then I need a smoke."
    <<elseif $NPCList[0].traits.includes("sociable")>>
        "Is <<nnpc_he Alex>> alright?" <<he>> asks, then notices the bottle. "Ah."
    <<elseif $NPCList[0].traits.includes("brooding")>>
        "Sorry kid," <<he>> says. "You're handling this better than Alex at least. Let's get <<nnpc_him Alex>> inside."
    <<else>>
        "That was a mess," <<he>> says. "Alex has the right idea. Odd choice of bed though."
    <</if>>
    <br><br>

    <<endevent>>
    <<npc Alex>><<person1>>
    Together, you carry Alex back to the cottage, and lay <<him>> in <<his>> bed. Remy won this round, but the war continues.
    <br><br>
<<else>>
    You carry <<him>> back to the cottage, and lay <<him>> in <<his>> bed. Remy won this round, but the war continues.
    <br><br>
<</if>>

<<unset $fields_damaged>>
<<unset $farm_destroyed>>
<<farm_assault_end>>

<<link [[Next|Farm Bedroom]]>><<endevent>><</link>>
<br>

:: Farm Assault Victory
<<effects>>

<<npc Alex>><<person1>>

<<if $farm_destroyed is true>>
    "You better stay the fuck away," Alex shouts after them. <<He>> turns to you. "I'm glad they wasted their time, but we shouldn't let them run rampant through the farm."
    <br><br>
<<elseif $fields_damaged gte 1>>
    "You better stay the fuck away," Alex shouts after them. <<He>> turns to you, then to the smoldering field behind <<him>>. "We limited the damage," <<he>> says. "We'll be more prepared next time."
    <br><br>
<<else>>
    "You better stay the fuck away," Alex shouts after them. <<He>> turns to you. Mud coats <<his>> body, but <<his>> smile is broad. "We did it. And we can do it again!"
    <br><br>
<</if>>

<<if $farm_assault.tower is "defeated">>
    <<He>> looks at the watchtower. "Fuck, is $farm.tower_guard okay?"
    <br><br>
    <<endevent>>
    <<loadNPC 0 "farm_tower_guard">><<person1>>
    You find the lookout sat at the base of the tower,
    <<if $NPCList[0].traits.includes("relaxed")>>
       trying to light a cigarette butt. "That was rougher than I expected," <<he>> says. "Could you help me up?"
    <<elseif $NPCList[0].traits.includes("sociable")>>
        chatting on <<his>> phone. "-bosses are here. Call you back." <<He>> smiles at you. "You should have seen how many I took on before they got me."
    <<elseif $NPCList[0].traits.includes("brooding")>>
        gazing at the sky. "Sorry kids," <<he>> says. "I like to think I gave as good as I got."
    <<else>>
        watching you. "Have the angels come to take me away?" <<he>> laughs. 
    <</if>>
    You and Alex help <<him>> to <<his>> feet.
    <<if $NPCList[0].traits.includes("relaxed")>>
       "I'll be alright" <<he>> continues. "Just need to stretch."
    <<elseif $NPCList[0].traits.includes("sociable")>>
        "There's a stool just inside," <<he>> continues. "A little rest would do me good."
    <<elseif $NPCList[0].traits.includes("brooding")>>
        "Don't worry about me," <<he>> continues. "I'll walk it off."
    <<else>>
        "Your touch has me feeling better already," <<he>> continues. "I think I can limp back to my post."
    <</if>>
    <br><br>
     
<<elseif $farm_assault.tower is "manned" or $farm_assault.tower is "attacked">>
    $farm.tower_guard approaches. 
    <<endevent>>
    <<loadNPC 0 "farm_tower_guard">><<person1>>
    <<if $NPCList[0].traits.includes("relaxed")>>
       "Glad you guys are alright,"<<he>> says. "That was almost too exciting."
    <<elseif $NPCList[0].traits.includes("sociable")>>
        "That livened things up," <<he>> says. "I think I need a breather."
    <<elseif $NPCList[0].traits.includes("brooding")>>
        "Good job," <<he>> says. "Hope I helped."
    <<else>>
        "You should've seen me up there," <<he>> says. "Three-" <<He>> pauses. "I mean, five, burly monsters came climbing the side of the tower, but I sent them packing."
    <</if>>
    <br><br>
<<else>>
    
<</if>>

<<endevent>>
<<npc Alex>><<person1>>
You walk back to the cottage. Alex pats your shoulder. "We won, but Remy will be back. We'll be ready."
<br><br>
<span class="red">Remy will attack again in $farm_attack_timer days.</span>
<br><br>

<<unset $fields_damaged>>
<<unset $farm_destroyed>>
<<farm_assault_end>>

<<link [[Next|Farm Cottage]]>><<endevent>><</link>>
<br>

:: Farm Assault Intro
<<effects>>
<<set $bus to "yard">>
<<farm_assault_init>>

You rush outside, and find Alex stood in the yard.
<br><br>
<<set $farm_attack_timer to random(17, 24)>>
<<npc Alex>><<person1>>
"They're not coming through here," <<he>> says, nodding at the road. "They'll try to sneak in." <<He>> hands you a walkie talkie. "There's a lot of ground to cover, so we'll need to split up. We'll be stronger if we team up to fight them though."

<<if $farm.tower gte 2 and $farm.tower_guard>>
    <<He>> waves at the watchtower, and $farm.tower_guard flashes the searchlight in response.
<<elseif $farm.tower and $farm.tower_guard>>
    <<He>> waves at the watchtower, and you make out $farm.tower_guard wave in response.
<<elseif $farm.tower>>
    <<He>> points at the watchtower. "We can climb it if we need a better view."
<</if>>
<br><br>

<<if $leftarm is "bound" or $rightarm is "bound">>
    Alex slices through your bindings. You're not defending the farm like that.
    <<unbind>>
    <br><br>
<</if>>

<<link [[Next|Farm Assault]]>><<endevent>><</link>>
<br>



:: Farm Assault Wardrobe
<<effects>>

<<if $phase is 2>>
    You enter the cottage, climb the stairs, and throw open the rustic wadrobe.
<<elseif $phase is 1>>
    You climb from your bed, and throw open the rustic wardrobe.
<<elseif $phase is 3>>
    You enter your room, and throw open the rustic wardrobe.
<<else>>
    You look through the rustic wardrobe.
<</if>>
<<set $phase to 0>>
You hear shouting outside.
<br><br>
<<set $wardrobe_location to "wardrobe">>
<<wardrobewear>>
<div id="wardrobeExits"><<wardrobeExits>></div>
<<wardrobe>>

:: Farm Assault Widgets [widget]
<<widget "farm_assault_init">>
<<set $farm_assault to {}>>
<<set $farm_assault.no to [0, 1, 2, 3]>>
<<if $farm_stage gte 8>>
    <<set $farm_assault.no.push(4)>>
<</if>>
<<if $farm_stage gte 9>>
    <<set $farm_assault.no.push(5)>>
<</if>>
<<if $farm_stage gte 10>>
    <<set $farm_assault.no.push(6)>>
<</if>>
<<if $farm_stage gte 11>>
    <<set $farm_assault.no.push(7)>>
<</if>>
<<if $farm_stage gte 12>>
    <<set $farm_assault.no.push(8)>>
<</if>>
<<set $farm_assault.teams to {}>>

<<if $farm_stage gte 12>>
    <<set $farm_assault.teams.team_1 to {}>>
    <<set $farm_assault.teams.team_2 to {}>>
    <<set $farm_assault.teams.team_3 to {}>>
    <<set $farm_assault.teams.team_4 to {}>>
    <<set $farm_assault.teams.team_5 to {}>>
    <<if $bailey_encroach>>
        <<set $farm_assault.teams.team_6 to {}>>
        <<set $farm_assault.teams.team_6.type to "bailey">>
    <</if>>
<<elseif $farm_stage gte 10>>
    <<set $farm_assault.teams.team_1 to {}>>
    <<set $farm_assault.teams.team_2 to {}>>
    <<set $farm_assault.teams.team_3 to {}>>
    <<set $farm_assault.teams.team_4 to {}>>
    <<if $bailey_encroach>>
        <<set $farm_assault.teams.team_5 to {}>>
        <<set $farm_assault.teams.team_5.type to "bailey">>
    <</if>>
<<elseif $farm_stage gte 8>>
    <<set $farm_assault.teams.team_1 to {}>>
    <<set $farm_assault.teams.team_2 to {}>>
    <<set $farm_assault.teams.team_3 to {}>>
    <<if $bailey_encroach>>
        <<set $farm_assault.teams.team_4 to {}>>
        <<set $farm_assault.teams.team_4.type to "bailey">>
    <</if>>
<<else>>
    <<set $farm_assault.teams.team_1 to {}>>
    <<set $farm_assault.teams.team_2 to {}>>
    <<if $bailey_encroach>>
        <<set $farm_assault.teams.team_3 to {}>>
        <<set $farm_assault.teams.team_3.type to "bailey">>
    <</if>>
<</if>>
<<set _assault_keys to Object.keys($farm_assault.teams)>>
<<for _s to 0; _s lt _assault_keys.length; _s++>>
    <<set $farm_assault.teams[_assault_keys[_s]].location to $farm_assault.no.pluck()>>
    <<set $farm_assault.teams[_assault_keys[_s]].wall_progress to 0>>
    <<set $farm_assault.teams[_assault_keys[_s]].field_progress to 0>>
    <<set $farm_assault.teams[_assault_keys[_s]].number to 3>>
    <<if !$farm_assault.teams[_assault_keys[_s]].type>>
        <<set $farm_assault.teams[_assault_keys[_s]].type to "remy">>
    <</if>>
<</for>>
<<set $fields_damaged to 0>>
<<if $farm.kennel gte 1>>
    <<set $farm_assault.dogs to 2>>
<<else>>
    <<set $farm_assault.dogs to 1>>
<</if>>
<<set $farm_assault.dogs_state to "guarding">>
<<if $farm.tower_guard>>
    <<set $farm_assault.tower to "manned">>
<<else>>
    <<set $farm_assault.tower to "empty">>
<</if>>
<<set $farm_assault.alex to "patrol">>
<</widget>>

<<widget "farm_assault_end">>
<<unset $farm_assault>>
<<unset $fields_damaged>>
<<unset $farm_destroyed>>
<</widget>>

<<widget "farm_assault_progress">>
<<set $farm_assault_done to 0>>
<<set _assault_keys to Object.keys($farm_assault.teams)>>
<<for _s to 0; _s lt _assault_keys.length; _s++>>
	<<if $farm_assault.teams[_assault_keys[_s]].state is undefined>>
        <<set $farm_assault.teams[_assault_keys[_s]].state to "wall">>
    <</if>>
    /*Fleeing checked before and after other actions. */
    <<farm_assault_flight>>
    <<if $farm_assault.teams[_assault_keys[_s]].location isnot "done">>
        /*Assaulting the tower. */
        <<if $farm_assault.teams[_assault_keys[_s]].location is "tower">>
            <<if $farm_assault.teams[_assault_keys[_s]].state is "approach">>
                <<set $farm_assault.teams[_assault_keys[_s]].state to "climb">>
            <<elseif $farm_assault.teams[_assault_keys[_s]].state is "climb">>
                <<set $farm_assault.teams[_assault_keys[_s]].state to "fight">>
            <<elseif $farm_assault.teams[_assault_keys[_s]].state is "fight">>
                <<if $farm_assault.teams[_assault_keys[_s]].type is "bailey">>
                    <<if $farm.tower_guard_skill gte random(1, 2000)>>
                        <<set $farm_assault.teams[_assault_keys[_s]].number -= 1>>
                        <<if $farm_assault.teams[_assault_keys[_s]].number lte 0>>
                            <<set $farm_assault.tower to "manned">>
                        <</if>>
                        <<set _guard_won to true>>
                    <<else>>
                        <<set $farm_assault.tower to "defeated">>
                        <<set $farm_assault.teams[_assault_keys[_s]].location to $farm_assault.no.pluck()>>
                        <<set $farm_assault.teams[_assault_keys[_s]].state to "field">>
                        <<set _guard_lost to true>>
                    <</if>>
                <<else>>
                    <<if $farm.tower_guard_skill gte random(1, 1000)>>
                        <<set $farm_assault.teams[_assault_keys[_s]].number -= 1>>
                        <<if $farm_assault.teams[_assault_keys[_s]].number lte 0>>
                            <<set $farm_assault.tower to "manned">>
                        <</if>>
                        <<set _guard_won to true>>
                    <<else>>
                        <<set $farm_assault.tower to "defeated">>
                        <<set $farm_assault.teams[_assault_keys[_s]].location to $farm_assault.no.pluck()>>
                        <<set $farm_assault.teams[_assault_keys[_s]].state to "field">>
                        <<set _guard_lost to true>>
                    <</if>>
                <</if>>
            <</if>>
        <</if>>
        /*Successfully burning. */
        <<if $farm_assault.teams[_assault_keys[_s]].state is "celebrate">>
            <<set $farm_assault.teams[_assault_keys[_s]].state to "field">>
            <<set $farm_assault.teams[_assault_keys[_s]].location to $farm_assault.no.pluck()>>
            <<if $farm_assault.teams[_assault_keys[_s]].location is undefined>>
                <<set $farm_assault.teams[_assault_keys[_s]].location to "done">>
            <</if>>
        <</if>>
        /*Burning a field. */
        <<if $farm_assault.teams[_assault_keys[_s]].state is "field">>
            <<if $farm_assault.teams[_assault_keys[_s]].field_progress gte 4>>
                <<set $farm_assault.teams[_assault_keys[_s]].field_progress to 0>>
                <<set $farm_assault.teams[_assault_keys[_s]].state to "celebrate">>
                <<set _smoke to true>>
                <<damage_farm 1>>
            <<else>>
                <<set $farm_assault.teams[_assault_keys[_s]].field_progress += 1>>
            <</if>>
        <</if>>
        /*Responding to hounds. */
        <<if $farm_assault.teams[_assault_keys[_s]].state is "dogs_recover">>
            <<if $farm_assault.teams[_assault_keys[_s]].type is "bailey">>
                <<set $farm_assault.teams[_assault_keys[_s]].number -= 1>>
                <<if $farm_assault.tower is "manned">>
                    <<set $farm_assault.no.push($farm_assault.teams[_assault_keys[_s]].location)>>/*Add their location back to the pool.*/
                    <<set $farm_assault.teams[_assault_keys[_s]].location to "tower">>
                    <<set $farm_assault.teams[_assault_keys[_s]].state to "approach">>
                    <<set $farm_assault.tower to "attacked">>
                <<else>>
                    <<set $farm_assault.teams[_assault_keys[_s]].state to "field">>
                <</if>>
            <<else>>
                <<set $farm_assault.teams[_assault_keys[_s]].location to "done">>
            <</if>>
            <<set $farm_assault.dogs -= 1>>
            <<if $farm_assault.dogs gte 1>>
                <<set $farm_assault.dogs_state to "guarding">>
                <<set _dogs_status to "victorious">>
            <<else>>
                <<set $farm_assault.dogs_state to "defeated">>
                <<set _dogs_status to "defeated">>
            <</if>>
            <<set $farm_assault.dogs_target to _assault_keys[_s]>>
        <</if>>
        /*Intercepted by hounds. */
        <<if $farm_assault.teams[_assault_keys[_s]].state is "dogs">>
            <<set $farm_assault.teams[_assault_keys[_s]].state to "dogs_recover">>
        <</if>>
        /*Entering. */
        <<if $farm_assault.teams[_assault_keys[_s]].state is "entry">>
            <<if $farm_assault.dogs gte 1 and $farm_assault.dogs_state is "guarding">>
                <<set $farm_assault.teams[_assault_keys[_s]].state to "dogs">>
                <<set $farm_assault.dogs_state to "fighting">>
            <<elseif ($farm_assault.teams[_assault_keys[_s]].type is "bailey" or random(1, 2) is 2) and $farm_assault.tower is "manned">>
                <<set $farm_assault.no.push($farm_assault.teams[_assault_keys[_s]].location)>>/*Add their location back to the pool.*/
                <<set $farm_assault.teams[_assault_keys[_s]].location to "tower">>
                <<set $farm_assault.teams[_assault_keys[_s]].state to "approach">>
                <<set $farm_assault.tower to "attacked">>
            <<else>>
                <<set $farm_assault.teams[_assault_keys[_s]].state to "field">>
            <</if>>
        <</if>>
        /*Breaking in. */
        <<if $farm_assault.teams[_assault_keys[_s]].state is "wall">>
            <<if $farm_assault.teams[_assault_keys[_s]].wall_progress gte $farm.wall>>
                <<set $farm_assault.teams[_assault_keys[_s]].state to "entry">>
                <<set $farm_assault.teams[_assault_keys[_s]].wall_progress to 0>>
            <<else>>
                <<if $farm.wall gte 4 and $farm_assault.teams[_assault_keys[_s]].type isnot "bailey">>
                    <<if random(1, 3) is 3>>
                        <<set $farm_assault.teams[_assault_keys[_s]].wall_progress += 1>>
                    <</if>>
                <<elseif $farm.wall gte 3 and $farm_assault.teams[_assault_keys[_s]].type isnot "bailey">>
                    <<if random(1, 3) gte 2>>
                        <<set $farm_assault.teams[_assault_keys[_s]].wall_progress += 1>>
                    <</if>>
                <<else>>
                    <<set $farm_assault.teams[_assault_keys[_s]].wall_progress += 1>>
                <</if>>
            
            <</if>>
        <</if>>
    <</if>>
    /*Fleeing. */
    <<farm_assault_flight>>
    /*Alex. */
    <<if $farm_assault.alex is "patrol">>
        <<if $farm_assault.teams[_assault_keys[_s]].location isnot "done">>
            <<set $farm_assault.alex to _assault_keys[_s]>>
        <</if>>
    <<elseif $farm_assault.alex is _assault_keys[_s]>>
        <<if $farm_assault.teams[_assault_keys[_s]].type is "bailey">>
            <<if random(1, 100) gte 80>>
                <<set $farm_assault.teams[_assault_keys[_s]].number -= 1>>
                <<set _alex_success to true>>
            <</if>>
        <<else>>
            <<if random(1, 100) gte 60>>
                <<set $farm_assault.teams[_assault_keys[_s]].number -= 1>>
                 <<set _alex_success to true>>
            <</if>>
        <</if>>
    <</if>>
    /*Fleeing. */
    <<farm_assault_flight>>
<</for>>
<</widget>>

<<widget "farm_assault_flight">>
<<if $farm_assault.teams[_assault_keys[_s]].number lte 0>>/*Flee if numbers reduced to 0.*/
    <<set $farm_assault.teams[_assault_keys[_s]].location to "done">>
    <<if $farm_assault.alex is _assault_keys[_s]>>/*Alex patrols again. */
        <<set $farm_assault.alex to "patrol">>
    <</if>>
<</if>>
<<if $farm_assault.teams[_assault_keys[_s]].location isnot "done">>/*Assault ends when !_farm_assault_active.*/
    <<set _farm_assault_active to true>>
<<elseif $farm_assault.teams[_assault_keys[_s]].location gte 0>>
    <<set $farm_assault.no.push($farm_assault.teams[_assault_keys[_s]].location)>>/*Add their location back to the pool.*/
    <<if $farm_assault.alex is  _assault_keys[_s]>>/*Alex patrols again. */
        <<set $farm_assault.alex to "patrol">>
    <</if>>
<<elseif $farm_assault.teams[_assault_keys[_s]].location is "done">>
    <<set $farm_assault.alex to "patrol">>
<</if>>
<</widget>>

<<widget "farm_assault_info">>
<<if $args[0] is "guard">>
    <<set _skill to $farm.tower_guard_skill>>
<<else>>
    <<set _skill to 0>>
<</if>>
<<set _assault_keys to Object.keys($farm_assault.teams)>>
<<for _s to 0; _s lt _assault_keys.length; _s++>>
    <<if $farm_assault.teams[_assault_keys[_s]].location is "tower" and $farm_assault.teams[_assault_keys[_s]].state is "fight">>
        <<set _fighting to true>>
    <</if>>
<</for>>

<<if _fighting is true or _guard_won is true or _guard_lost is true>>
    Your walkie talkie picks up another signal. <span class="red">You hear a struggle, punctuated by static.</span> 
    <<if _guard_won is true>>
        You peer at the watchtower. A body falls from the top. <span class="green">It's not $farm.tower_guard.</span> Seems they got the better of one of their attackers.
    <<elseif _guard_lost is true>>
        You peer at the watchtower. A body falls from the top. <span class="red">It's $farm.tower_guard.</span> They won't be helping for the rest of the assault.
    <</if>>
    <br><br>
<<else>>
    <<if $args[0] is "guard">>
        Your walkie talkie picks up another signal. It's $farm.tower_guard, keeping you informed of enemy activity:
    <<else>>
        You look across the farm, trying to spot enemy movements:
    <</if>>
    <br>
    <<set _assault_keys to Object.keys($farm_assault.teams)>>
    <<for _s to 0; _s lt _assault_keys.length; _s++>>
        <<if $farm_assault.teams[_assault_keys[_s]].location is "done">>
            <span class="green">The <<farm_assault_no>> group of <<farm_assault_thugs>> are running for the hills.</span>
        <<elseif $farm_assault.teams[_assault_keys[_s]].state is "dogs">>
            You hear barking from <<farm_assault_location>>.
        <<elseif $farm_assault.teams[_assault_keys[_s]].location is "tower">>
            <<switch $farm_assault.teams[_assault_keys[_s]].state>>
            <<case "approach">>
                <span class="purple">The <<farm_assault_no>> group of <<farm_assault_thugs>> are approaching the watchtower.</span>
            <<case "climb">>
                <span class="pink">The <<farm_assault_no>> group of <<farm_assault_thugs>> are climbing the watchtower.</span>
            <</switch>>
        <<else>>
            <<if _skill gte random(1, 1000)>>
                <<switch $farm_assault.teams[_assault_keys[_s]].state>>
                <<case wall>>
                    The <<farm_assault_no>> group of <<farm_assault_thugs>> are
                    <<if $farm.wall gte 3>>
                        <span class="pink">cutting through the fence</span> at <<farm_assault_location>>.
                    <<else>>
                        climbing the wall near <<farm_assault_location>>.
                    <</if>>
                <<case entry>>
                    The <<farm_assault_no>> group of <<farm_assault_thugs>> are rushing into <<farm_assault_location>>.
                <<case field>>
                   <<switch $farm_assault.teams[_assault_keys[_s]].field_progress>>
                   <<case 0>>
                        <span class="blue">The <<farm_assault_no>> group of <<farm_assault_thugs>> are entering <<farm_assault_location>>.</span>
                   <<case 1>>
                        <span class="purple">The <<farm_assault_no>> group of <<farm_assault_thugs>> are opening petrol canisters at <<farm_assault_location>>.</span>
                   <<case 2>>
                        <span class="pink">The <<farm_assault_no>> group of <<farm_assault_thugs>> are pouring petrol over <<farm_assault_location>>.</span>
                   <<case 3>>
                        <span class="red">The <<farm_assault_no>> group of <<farm_assault_thugs>> are lighting matches at <<farm_assault_location>>.</span>
                   <</switch>>
                <<case celebrate>>
                    <span class="red">The <<farm_assault_no>> group of <<farm_assault_thugs>> are reveling as the field burns.</span>
                <</switch>>
            <<else>>
                There's movement at <<farm_assault_location>>.
            <</if>>
        <</if>>
        <br>
    <</for>>
    <br>
<</if>>
<</widget>>

<<widget "farm_assault_alex">>

<<if _farm_assault_active isnot true or $farm_destroyed is true>>
<<elseif $farm_assault.alex is "bound">>
    <<if $farm_assault.bindings_alex gte 1>>
        <<set $farm_assault.bindings_alex -= 1>>
    <<else>>
        <<set $farm_assault.alex to "patrol">>
    <</if>>
<<elseif $farm_assault.alex is "patrol">>
    Your walkie talkie picks up a signal. "I'm looking for intruders," Alex says. "Just checking in."
<<else>>
    <<set _assault_keys to Object.keys($farm_assault.teams)>>
    <<for _s to 0; _s lt _assault_keys.length; _s++>>
        <<if $bus is $farm_assault.teams[_assault_keys[_s]].location and $farm_assault.alex is _assault_keys[_s]>>
            <span class="teal">Alex crouches beside you.</span> "What's the plan?"
        <<elseif $farm_assault.alex is _assault_keys[_s]>>
            Your walkie talkie picks up a signal.
            <<set _rng to random(1, 5)>>
            <<switch _rng>>
            <<case 1>>
                "I'm pursuing
            <<case 2>>
                "I'm stalking
            <<case 3>>
                "I'm following
            <<case 4>>
                "I'm hunting
            <<default>>
                "I'm harrying
            <</switch>>
            <<farm_assault_thugs>> at <<farm_assault_location>>." Alex says in a hushed voice.
            <<if _alex_success>>
                <<set _rng to random(1, 5)>>
                <<switch _rng>>
                <<case 1>>
                    <span class="green">"Knocked one out."</span>
                <<case 2>>
                    <span class="green">"They'll feel this in the morning."</span>
                <<case 3>>
                    <span class="green">"Wonder when they'll realise they're missing a colleague."</span>
                <<case 4>>
                    <span class="green">"One thug down."</span>
                <<default>>
                    <span class="green">"Took one down."</span>
                <</switch>>
            <<else>>
                <<set _rng to random(1, 5)>>
                <<switch _rng>>
                <<case 1>>
                    <span class="blue">"Can't get them alone."</span>
                <<case 2>>
                    <span class="blue">"They're too watchful."</span>
                <<case 3>>
                    <span class="blue">"Can't get close."</span>
                <<case 4>>
                    <span class="blue">"Just waiting for my moment."</span>
                <<default>>
                    <span class="blue">"I won't take any risks."</span>
                <</switch>>
            <</if>>
        <</if>>
    <</for>>
<</if>>
<br><br>
<</widget>>

<<widget "farm_assault_location">>
<<switch $farm_assault.teams[_assault_keys[_s]].location>>
    <<case 0>>
        <<set _text_output to "the first field">>
    <<case 1>>
        <<set _text_output to "the second field">>
    <<case 2>>
        <<set _text_output to "the third field">>
    <<case 3>>
        <<set _text_output to "the fourth field">>
    <<case 4>>
        <<set _text_output to "the fifth field">>
    <<case 5>>
        <<set _text_output to "the sixth field">>
    <<case 6>>
        <<set _text_output to "the seventh field">>
    <<case 7>>
        <<set _text_output to "the eighth field">>
    <<case 8>>
        <<set _text_output to "the ninth field">>
    <<case tower>>
        <<set _text_output to "the watchtower">>
    <<default>>
        <<set _text_output to "the fields">>
<</switch>>
<<print _text_output>>
<</widget>>

<<widget "farm_assault_thugs">>
<<switch $farm_assault.teams[_assault_keys[_s]].type>>
    <<case "bailey">>
        <span class="red">Bailey's thugs</span>
    <<default>>
        <span class="pink">Remy's thugs</span>
<</switch>>
<</widget>>

<<widget "farm_assault_options">>

<<link [[Wait (0:05)|Farm Assault]]>><<pass 5>><<set $farm_assault.movement to "wait">><</link>>
<br>
<<if $bus is "tower" and _tower isnot "threatened" and $farm_assault.tower isnot "manned">>
    <<link [[Climb the watchtower|Farm Assault]]>><<pass 5>><<set $bus to "tower_top">><<set $farm_assault.movement to "climb">><</link>>
    <br>
<</if>>
<<if $bus isnot 0>>
    <<link [[First field (0:05)|Farm Assault]]>><<pass 5>><<set $bus to 0>><<set $farm_assault.movement to "field">><</link>>
    <br>
<</if>>
<<if $bus isnot 1>>
    <<link [[Second field (0:05)|Farm Assault]]>><<pass 5>><<set $bus to 1>><<set $farm_assault.movement to "field">><</link>>
    <br>
<</if>>
<<if $bus isnot 2>>
    <<link [[Third field (0:05)|Farm Assault]]>><<pass 5>><<set $bus to 2>><<set $farm_assault.movement to "field">><</link>>
    <br>
<</if>>
<<if $bus isnot 3>>
    <<link [[Fourth field (0:05)|Farm Assault]]>><<pass 5>><<set $bus to 3>><<set $farm_assault.movement to "field">><</link>>
    <br>
<</if>>
<<if $bus isnot 4 and $farm_stage gte 8>>
    <<link [[Fifth field (0:05)|Farm Assault]]>><<pass 5>><<set $bus to 4>><<set $farm_assault.movement to "field">><</link>>
    <br>
<</if>>
<<if $bus isnot 5 and $farm_stage gte 9>>
    <<link [[Sixth field (0:05)|Farm Assault]]>><<pass 5>><<set $bus to 5>><<set $farm_assault.movement to "field">><</link>>
    <br>
<</if>>
<<if $bus isnot 6 and $farm_stage gte 10>>
    <<link [[Seventh field (0:05)|Farm Assault]]>><<pass 5>><<set $bus to 6>><<set $farm_assault.movement to "field">><</link>>
    <br>
<</if>>
<<if $bus isnot 7 and $farm_stage gte 11>>
    <<link [[Eighth field (0:05)|Farm Assault]]>><<pass 5>><<set $bus to 7>><<set $farm_assault.movement to "field">><</link>>
    <br>
<</if>>
<<if $bus isnot 8 and $farm_stage gte 12>>
    <<link [[Ninth field (0:05)|Farm Assault]]>><<pass 5>><<set $bus to 8>><<set $farm_assault.movement to "field">><</link>>
    <br>
<</if>>
<<if $bus isnot "tower" and $bus isnot "tower_top" and $farm.tower gte 1>>
    <<link [[Watchtower (0:05)|Farm Assault]]>><<pass 5>><<set $bus to "tower">><<set $farm_assault.movement to "tower">><</link>>
    <br>
<</if>>

<</widget>>

<<widget "farm_assault_actions">>


<<switch $bus>>
<<case "tower">>
    The watchtower looms above you.
<<case 0>>
    You are near the first field.
<<case 1>>
    You are near the second field.
<<case 2>>
    You are near the third field.
<<case 3>>
    You are near the fourth field.
<<case 4>>
    You are near the fifth field.
<<case 5>>
    You are near the sixth field.
<<case 6>>
    You are near the seventh field.
<<case 7>>
    You are near the eighth field.
<<case 8>>
    You are near the ninth field.
<</switch>>
<br>
<<if $farm_assault.bindings gte 1>>
    You lie in the dirt, unable to move much.
    <br><br>

    <<link [[Struggle (0:05)|Farm Assault]]>><<pass 5>><<set $farm_assault.bindings -= 1>><<set $farm_assault.movement to "struggle">><</link>>
    <br>
<<else>>
    <<set _assault_keys to Object.keys($farm_assault.teams)>>
    <<for _s to 0; _s lt _assault_keys.length; _s++>>
        <<if $bus is $farm_assault.teams[_assault_keys[_s]].location>>
            <<if $bus is "tower">>
                <<if $farm_assault.teams[_assault_keys[_s]].state is "approach">>
                    <span class="blue"><<farm_assault_thugs>> approach.</span>
                    <br><br>
                    <<farm_assault_attack_options>>
                <<elseif $farm_assault.teams[_assault_keys[_s]].state is "climb">>
                    <span class="purple">You see <<farm_assault_thugs>> entering the tower.</span>
                    <br><br>

                    <<link [[Defend the watchtower (0:05)|Farm Assault Tower Defend]]>><<pass 5>><</link>>
                    <br>
                <<elseif $farm_assault.teams[_assault_keys[_s]].state is "fight">>
                    <span class="pink">You hear $farm.tower_guard fighting <<farm_assault_thugs>> at the top of the tower!</span>
                    <br><br>
                    
                    <<link [[Defend the watchtower (0:05)|Farm Assault Tower Defend]]>><<pass 5>><</link>>
                    <br>
                <</if>>
            <<elseif $farm_assault.teams[_assault_keys[_s]].state is "wall">>
                <<if $farm.wall gte 3>>
                    You see <<farm_assault_thugs>> sawing through the fence.
                <<else>>
                    You see <<farm_assault_thugs>> climbing over the wall.
                <</if>>
                <<if $farm_assault.teams[_assault_keys[_s]].number is 1>>
                    There's only one here.
                <<else>>
                    There are <<print $farm_assault.teams[_assault_keys[_s]].number>> of them.
                <</if>>
                <<if $farm_assault.teams[_assault_keys[_s]].type is "bailey">>
                    <span class="red">They move with surety.</span>
                <</if>>
                <br>
                <<if $farm_assault.alex is _assault_keys[_s]>>
                    <<link [[Throw rocks with Alex (0:05)|Farm Assault Rocks Alex]]>><<pass 5>><</link>>
                    <br>
                <<else>>
                    <<link [[Throw rocks (0:05)|Farm Assault Rocks]]>><<pass 5>><</link>><<if $farm_assault.teams[_assault_keys[_s]].type is "bailey">><<physiquedifficulty 6000 20000>><<else>><<physiquedifficulty 1 16000>><</if>>
                    <br>
                    <<link [[Threaten|Farm Assault Threaten]]>><<pass 5>><</link>><<if $farm_assault.teams[_assault_keys[_s]].type is "bailey">><<skill_difficulty famescrap "Combat Fame" 3000 3000>><<else>><<skill_difficulty famescrap "Combat Fame" 200 1000>><</if>>
                    <br>
                <</if>>
            <<elseif $farm_assault.teams[_assault_keys[_s]].state is "entry">>
                <<if $farm_assault.teams[_assault_keys[_s]].type is "bailey">>
                    <<if $farm_assault.teams[_assault_keys[_s]].number gte 2>>
                        You see <<print $farm_assault.teams[_assault_keys[_s]].number>> of <<farm_assault_thugs>> rush into the farm. They ignore you, instead heading into the fields.
                        <br>
                        <<farm_assault_attack_options>>
                    <<else>>
                        You see one of <<farm_assault_thugs>> rush into the farm.
                        <br>
                        <<farm_assault_attack_options>>
                    <</if>>
                <<else>>
                    <<if $farm_assault.teams[_assault_keys[_s]].number gte 2>>
                        You see <<print $farm_assault.teams[_assault_keys[_s]].number>> of <<farm_assault_thugs>> rush into the farm. They ignore you, instead heading into the fields.
                        <br><br>
                        
                        <<farm_assault_attack_options>>
                    <<else>>
                        You see one of <<farm_assault_thugs>> rush into the farm.
                        <br><br>

                        <<farm_assault_attack_options>>
                    <</if>>
                <</if>>
            <<elseif $farm_assault.teams[_assault_keys[_s]].state is "dogs">>
                <span class="green">Your <<farm_text_many dog>> emerge from the dark, and set upon <<farm_assault_thugs>>!</span>
                <br><br>
            <<elseif $farm_assault.teams[_assault_keys[_s]].state is "dogs_recover">>
                <<if $farm_assault.teams[_assault_keys[_s]].type is "bailey">>
                    <<if $farm_assault.teams[_assault_keys[_s]].number gte 2>>
                        <<if $farm_assault.dogs gte 2>>
                            <<farm_assault_thugs>> seem unperturbed, and meet the hounds head-on. The first <<farm_text dog>> receives a solid kick to the face, and rolls away, whimpering, but the others manage to sink teeth into arms and legs. The thugs shake them free, but are left bloodied. <span class="green">A <<generate1>><<person1>><<person>> limps from the field,</span> too hurt to continue the assault.
                            <br><br>
                        <<else>>
                            <<farm_assault_thugs>> seem unperturbed, and meet the hounds head-on. The first <<farm_text dog>> <span class="red">receives a solid kick to the face,</span> and rolls away, whimpering, but the others manage to sink teeth into arms and legs.
                            <br><br>
                            The thugs punch and kick at the hounds, <span class="red">scaring them away,</span> but are left bloodied. <span class="green">A <<generate1>><<person1>><<person>> limps from the field,</span> too hurt to continue the assault.
                            <br><br>

                        <</if>>
                    <<else>>
                        <<if $farm_assault.dogs gte 2>>
                            <<generate1>><<person1>>
                            The thug, a <<person>>, startles the hounds by barking back. One growls before lunging, grabbing the <<persons>> forearm between <<his>> teeth. <<He>> shakes the <<farm_text dog>> off, but is in no condition to continue the assault. <span class="green"><<He>> runs from the field,</span> cradling one arm in the other.
                            <br><br>
                        <<else>>
                            <<generate1>><<person1>>
                            The thug, a <<person>>, startles the hounds by barking back. One growls before lunging, grabbing the <<persons>> forearm between <<his>> teeth. <span class="red">punches the <<farm_text dog>> in the nose,</span> freeing <<his>> arm, but is in no condition to continue the assault. <span class="green"><<He>> runs from the field,</span> cradling one arm in the other.
                            <br><br>
                        <</if>>
                    <</if>>
                <<else>>
                    <<if $farm_assault.teams[_assault_keys[_s]].number gte 2>>
                        <<if $farm_assault.dogs gte 2>>
                            <<farm_assault_thugs>> panic, <span class="green">and run.</span> The hounds pursue them to the <<farm_fence>>, and howl triumphant into the night.
                        <<else>>
                            <<farm_assault_thugs>> panic, <span class="green">and run.</span> The hounds pursue a little too eagerly, <span class="red">and chase their quarry into the night,</span> leaving the farm unguarded. They'll be too tired to help when they make it back.
                        <</if>>
                        <br><br>
                    <<else>>
                        <<generate1>><<person1>>
                        <<if $farm_assault.dogs gte 2>>
                            The lone <<person>> panics, <span class="green">and runs.</span> The hounds pursue <<him>> to the <<farm_fence>>, and howl triumphant into the night.
                        <<else>>
                            The lone <<person>> panics, <span class="green">and runs.</span> The hounds pursue a little too eagerly, <span class="red">and chase their quarry into the night,</span> leaving the farm unguarded. They'll be too tired to help when they make it back.
                        <</if>>
                        <br><br>
                    <</if>> 
                <</if>>
                <<endevent>>
                <<farm_assault_attack_options>>
            <<elseif $farm_assault.teams[_assault_keys[_s]].state is "field">>
                <<if $farm_assault.teams[_assault_keys[_s]].field_progress gte 4>>
                    <span class="pink">You see <<farm_assault_thugs>> lighting matches!</span>
                <<elseif $farm_assault.teams[_assault_keys[_s]].field_progress gte 3>>
                    <span class="purple">You see <<farm_assault_thugs>> covering the field in petrol.</span>
                <<elseif $farm_assault.teams[_assault_keys[_s]].field_progress gte 2>>
                    <span class="blue">You see <<farm_assault_thugs>> opening petrol canisters.</span>
                <<else>>
                    <span class="lblue">You see <<farm_assault_thugs>> prowling through the field.</span>
                <</if>>
                <br>
                <<farm_assault_attack_options>>
            <</if>>
        <</if>>
    <</for>>

    <br>

    <<farm_assault_options>>
<</if>>

<</widget>>


<<widget "farm_assault_intruders">>
<<if $farm_assault.teams[_assault_keys[_s]].number gte 2>>
    <<set _text_output to "intruders">>
<<else>>
    <<set _text_output to "intruder">>
<</if>>
<<print _text_output>>
<</widget>>



<<widget "farm_assault_no">>
<<if $farm_assault.teams[_assault_keys[_s]].type is "bailey">>
    vicious
<<else>>
    <<switch _s>>
    <<case 0>>
        first
    <<case 1>>
        second
    <<case 2>>
        third
    <<case 3>>
        fourth
    <<case 4>>
        fifth
    <</switch>>
<</if>>
<</widget>>


<<widget "farm_assault_unbind">>
<<unbind>>
<<set $farm_assault.bindings to 0>>
<<set $worn.face.type.push("broken")>>
<<faceruined>>
<<clotheson>>
<</widget>>

<<widget "farm_assault_attack_options">>
<<if $farm_assault.alex is _assault_keys[_s]>>
    <<if $farm_assault.teams[_assault_keys[_s]].number gte 2>>
        <<link [[Work with Alex to pick one off (0:05)|Farm Assault Pick Alex]]>><<pass 5>><</link>>
        <br>
        <<if $pain gte 100>>
            <span class="red">You are in too much pain to fight them head on.</span>
        <<else>>
            <<link [[Charge with Alex (0:05)|Farm Assault Charge]]>><<pass 5>><</link>>
            <br>
        <</if>>
    <<elseif $farm_assault.teams[_assault_keys[_s]].number gte 1 and $farm_assault.teams[_assault_keys[_s]].location isnot "done" and $farm_assault.teams[_assault_keys[_s]].state isnot "dogs_recover">>
        The intruder is alone.
        <br><br>
        <<link [[Overpower|Farm Assault Overpower]]>><</link>>
        <br>
    <</if>>
<<elseif $pain gte 100>>
    <span class="red">You're in too much pain to fight them head-on.</span>
    <br>
<<else>>
    <<if $farm_assault.teams[_assault_keys[_s]].type is "bailey">>
        <<link [[Fight them head-on (0:05)|Farm Assault Intercept Bailey]]>><<pass 5>><</link>>
        <br>
        <<set $skulduggerydifficulty to 1000>>
        <<link [[Pick one off (0:05)|Farm Assault Pick Bailey]]>><<pass 5>><</link>><<skulduggerydifficulty>>
        <br>
    <<else>>
        <<link [[Fight them head-on (0:05)|Farm Assault Intercept]]>><<pass 5>><</link>>
        <br>
        <<set $skulduggerydifficulty to 600>>
        <<link [[Pick one off (0:05)|Farm Assault Pick]]>><<pass 5>><</link>><<skulduggerydifficulty>>
        <br>
    <</if>>
<</if>>
<</widget>>

:: Farm Assault Rocks
<<effects>>

<<set _assault_keys to Object.keys($farm_assault.teams)>>
<<for _s to 0; _s lt _assault_keys.length; _s++>>
    <<if $bus is $farm_assault.teams[_assault_keys[_s]].location>>
        <<if $physiqueSuccess>>
            <<generate1>><<person1>>
            You and Alex pelt the <<farm_assault_intruders>> from the shadows. Most miss, <span class="green">but one lands true</span>, hitting the <<person>> right on the noggin. <<He>> tumbles away from the <<farm_fence>>.
            <br><br>
            <<set $farm_assault.teams[_assault_keys[_s]].number -= 1>>
        <<else>>
            <<generate1>><<person1>>
            You pelt the <<farm_assault_intruders>> from the shadows. They've chosen a sheltered spot to break in, shielded by earth from most angles, and trees by others. <span class="red">You fail to hit any.</span>
            <br><br>
        <</if>>
    <</if>>
<</for>>

<<link [[Next|Farm Assault]]>><<endevent>><</link>>
<br>

:: Farm Assault Rocks Alex
<<effects>>

<<set _assault_keys to Object.keys($farm_assault.teams)>>
<<for _s to 0; _s lt _assault_keys.length; _s++>>
    <<if $bus is $farm_assault.teams[_assault_keys[_s]].location>>
        <<if $farm_assault.teams[_assault_keys[_s]].type is "bailey" and random(1, 2) is 2>>
            <<generate1>><<person1>>
            You and Alex pelt the <<farm_assault_intruders>> from the shadows. They've chosen a sheltered spot to break in, shielded by earth from most angles, and trees by the others. <span class="red">You fail to hit any.</span>
            <br><br>
        <<else>>
            <<generate1>><<person1>>
            You and Alex pelt the <<farm_assault_intruders>> from the shadows. Most miss, <span class="green">but one lands true</span>, hitting the <<person>> right on the noggin. <<He>> tumbles away from the <<farm_fence>>.
            <br><br>
            <<set $farm_assault.teams[_assault_keys[_s]].number -= 1>>
        <</if>>
    <</if>>
<</for>>

<<link [[Next|Farm Assault]]>><<endevent>><</link>>
<br>

:: Farm Assault Threaten
<<effects>>

You march into the open.
<<if $submissive gte 1150>>
    "I-I won't be bullied," you say. "Stop this at once, or you'll be sorry."
<<elseif $submissive lte 850>>
    "Get the fuck off my property," you say. "Before I feed you to the pigs."
<<else>>
    "If you leave now," you say. "I won't follow."
<</if>>
<br><br>
<<set _assault_keys to Object.keys($farm_assault.teams)>>
<<for _s to 0; _s lt _assault_keys.length; _s++>>
    <<if $bus is $farm_assault.teams[_assault_keys[_s]].location>>
        <<if $farm_assault.teams[_assault_keys[_s]].type is "bailey">>
            <<if $farm_assault.teams[_assault_keys[_s]].number gte 2>>
                <<generate1>><<person1>>
                <span class="red">The intruders laugh.</span> "Very scary," a <<person>> says. "But there's scarier behind us." They continue forcing their way in.
            <<else>>
                <<generate1>><<person1>>
                <span class="red">The <<person>> laughs.</span> "Very scary," the <<person>> says. "But there's scarier behind me." <<He>> continues forcing their way in.
            <</if>>
        <<elseif $famescrap gte random(200, 1000)>>
            <<if $farm_assault.teams[_assault_keys[_s]].number gte 2>>
                <<generate1>><<person1>><<generate2>>
                The intruders glance at each other.
                <br>
                "Is that the one they call <span class="pink"><<underworld_nickname>></span>?" a <<person>> asks.
                <br>
                "Aye. That's why we're paid so well," a <<person2>><<person>> responds.
                <br>
                "I'm not getting paid to get my shit kicked in. I'm out." <span class="green">They turn and run.</span>
                <br><br>

                <<set $farm_assault.teams[_assault_keys[_s]].location to "done">>
            <<else>>
                <<generate1>><<person1>>
                The intruder, a <<person>>, stares at you. "I'm just getting paid to clear some fields," <<he>> says. "I don't want no trouble." <span class="green"><<He>> turns and leaves.</span>
                <br><br>

               <<set $farm_assault.teams[_assault_keys[_s]].location to "done">>
            <</if>>
        <<else>>
            <<if $farm_assault.teams[_assault_keys[_s]].number gte 2>>
                <<generate1>><<person1>><<generate2>>
                The intruders glance at each other, <span class="red">and laugh.</span> "This <<girl>> thinks <<pshes>> tough or something," a <<person>> says. "About to learn a hard lesson."
                <br><br>
                They continue forcing their way in.
                <br><br>
            <<else>>
                <<generate1>><<person1>>
                <span class="red">The intruder laughs. "Who do you think you are?" <<he>> says. "Some <<girl>> is all I see, about to learn a hard lesson." <<He>> continues to enter.
                <br><br>
            <</if>>
        <</if>>
    <</if>>
<</for>>
<br><br>

<<link [[Next|Farm Assault]]>><<endevent>><</link>>
<br>


:: Farm Assault Intercept
<<effects>>

<<set _assault_keys to Object.keys($farm_assault.teams)>>
<<for _s to 0; _s lt _assault_keys.length; _s++>>
    <<if $bus is $farm_assault.teams[_assault_keys[_s]].location>>
        <<if $farm_assault.teams[_assault_keys[_s]].number gte 3>>
            <<generate1>><<generate2>><<generate3>>
            You charge Remy's thugs, a <<person1>><<person>>, <<person2>><<person>>, and <<person3>><<person>>. They plant their feet, ready to face you.
            <br><br>
        <<elseif $farm_assault.teams[_assault_keys[_s]].number gte 2>>
            <<generate1>><<generate2>>
            You charge Remy's thugs, a <<person1>><<person>> and <<person2>><<person>>. They plant their feet, ready to face you.
            <br><br>
        <<else>>
            <<generate1>>
            You charge Remy's thug, a <<person1>><<person>>. <<He>> seems startled by your boldness, but plants <<his>> feet as you approach.
            <br><br>
        <</if>>
    <</if>>
<</for>>

<<link [[Next|Farm Assault Fight]]>><<set $fightstart to 1>><</link>>
<br>


:: Farm Assault Intercept Bailey
<<effects>>

<<set _assault_keys to Object.keys($farm_assault.teams)>>
<<for _s to 0; _s lt _assault_keys.length; _s++>>
    <<if $bus is $farm_assault.teams[_assault_keys[_s]].location>>
        <<if $farm_assault.teams[_assault_keys[_s]].number gte 3>>
            <<generate1>><<generate2>><<generate3>>
            You charge Bailey's thugs, a <<person1>><<person>>, <<person2>><<person>>, and <<person3>><<person>>. They turn to meet you. The <<person1>><<person>> cracks <<his>> knuckles.
            <br><br>
        <<elseif $farm_assault.teams[_assault_keys[_s]].number gte 2>>
            <<generate1>><<generate2>>
            You charge Bailey's thugs, a <<person1>><<person>> and <<person2>><<person>>. They turn to meet you. The <<person1>><<person>> cracks <<his>> knuckles.
            <br><br>
        <<else>>
            <<generate1>>
            You charge Bailey's thug, a <<person1>><<person>>. <<He>> turns to meet you, and cracks <<his>> knuckles.
            <br><br>
        <</if>>
    <</if>>
<</for>>

<<link [[Next|Farm Assault Fight Bailey]]>><<set $fightstart to 1>><</link>>
<br>




:: Farm Assault Fight
<<if $fightstart is 1>>
	<<set $fightstart to 0>>

	<<neutral 1>>

	<<maninit>>
	<<set $enemytrust -= 100>>
	<<set $enemyanger += 200>>
	<<npcidlegenitals>>

<</if>>

<<effects>>
<<effectsman>><<man>>

<<stateman>>
<br><br>
<<actionsman>>

<<if $enemyhealth lte 0>>
	<span id="next"><<link [[Next|Farm Assault Fight Finish]]>><</link>></span><<nexttext>>
<<elseif $enemyarousal gte $enemyarousalmax>>
	<span id="next"><<link [[Next|Farm Assault Fight Finish]]>><</link>></span><<nexttext>>
<<elseif $pain gte 100 and $willpowerpain is 0>>
	<span id="next"><<link [[Next|Farm Assault Fight Finish]]>><</link>></span><<nexttext>>
<<else>>
	<span id="next"><<link [[Next|Farm Assault Fight]]>><</link>></span><<nexttext>>
<</if>>

:: Farm Assault Fight Finish
<<effects>>
<<if $enemyarousal gte $enemyarousalmax>>
	<<ejaculation>>
    <<if $enemyno gte 2>>
        Remy's thugs are too dazed and exhausted to continue, <span class="green">and stagger from the field.</span>
    <<else>>
        The <<person1>><<person>> is too dazed and exhausted to continue, <span class="green">and staggers from the field.</span>
    <</if>>
    <br><br>
	<<tearful>> you plan your next move.
	<br><br>
	<<clotheson>>
	<<endcombat>>
	<<link [[Next|Farm Assault]]>><</link>>
    <br>
    <<set _assault_keys to Object.keys($farm_assault.teams)>>
    <<for _s to 0; _s lt _assault_keys.length; _s++>>
        <<if $bus is $farm_assault.teams[_assault_keys[_s]].location>>
            <<set $farm_assault.teams[_assault_keys[_s]].location to "done">>
        <</if>>
    <</for>>
<<elseif $enemyhealth lte 0>>
	<<if $enemyno gte 2>>
        <span class="green">Remy's thugs flee the field,</span> throwing worried glances over their shoulders to make sure you're not pursuing.
    <<else>>
        <span class="green">The <<person1>><<person>> flees the field,</span> throwing worried glances over <<his>> shoulder to make sure you're not pursing.
    <</if>>
	<br><br>
	<<tearful>> you plan your next move.
	<br><br>
	<<clotheson>>
	<<endcombat>>
	<<link [[Next|Farm Assault]]>><</link>>
    <br>
    <<set _assault_keys to Object.keys($farm_assault.teams)>>
    <<for _s to 0; _s lt _assault_keys.length; _s++>>
        <<if $bus is $farm_assault.teams[_assault_keys[_s]].location>>
            <<set $farm_assault.teams[_assault_keys[_s]].location to "done">>
        <</if>>
    <</for>>

<<else>>
	You fall to the earth, too hurt to continue fighting.
	<br><br>
	The <<person1>><<person>> crouches over you, <span class="purple">and gropes your <<breasts>></span>. "Shame I got a job to do," <<he>> says.
	<br><br>
    You can't stop <<him>> binding your arms and legs together, and tying a gag around your mouth. "Later <<girl>>."
    <br><br>
    <<tearful>> you struggle against the rope. It was a rough job, and you should be able to work free.
    <br><br>
	<<endcombat>>
    <<set $farm_assault.bindings to 3>>
    <<bind>>
    <<facewear 4>>
	<<link [[Next|Farm Assault]]>><</link>>
    <br>
    
<</if>>

:: Farm Assault Fight Bailey
<<if $fightstart is 1>>
	<<set $fightstart to 0>>

	<<neutral 1>>

	<<maninit>>
	<<set $enemytrust -= 100>>
	<<set $enemyanger += 200>>
	<<npcidlegenitals>>
    <<set $enemyhealthmax *= 1.3>>
    <<set $enemyhealth *= 1.3>>
    <<set $enemyarousalmax *= 1.3>>
<</if>>

<<effects>>
<<effectsman>><<man>>

<<stateman>>
<br><br>
<<actionsman>>

<<if $enemyhealth lte 0>>
	<span id="next"><<link [[Next|Farm Assault Fight Bailey Finish]]>><</link>></span><<nexttext>>
<<elseif $enemyarousal gte $enemyarousalmax>>
	<span id="next"><<link [[Next|Farm Assault Fight Bailey Finish]]>><</link>></span><<nexttext>>
<<elseif $pain gte 100 and $willpowerpain is 0>>
	<span id="next"><<link [[Next|Farm Assault Fight Bailey Finish]]>><</link>></span><<nexttext>>
<<else>>
	<span id="next"><<link [[Next|Farm Assault Fight Bailey]]>><</link>></span><<nexttext>>
<</if>>

:: Farm Assault Fight Bailey Finish
<<effects>>
<<if $enemyarousal gte $enemyarousalmax>>
	<<ejaculation>>
    "You'll go far," the <<person1>><<person>> mutters.
    <<if $enemyno gte 2>>
        Bailey's thugs are too dazed and exhausted to continue, <span class="green">and stagger from the field.</span>
    <<else>>
        <<Hes>> too dazed and exhausted to continue, <span class="green">and staggers from the field.</span>
    <</if>>
    <br><br>
	<<tearful>> you plan your next move.
	<br><br>
	<<clotheson>>
	<<endcombat>>
	<<link [[Next|Farm Assault]]>><</link>>
    <br>
    <<set _assault_keys to Object.keys($farm_assault.teams)>>
    <<for _s to 0; _s lt _assault_keys.length; _s++>>
        <<if $bus is $farm_assault.teams[_assault_keys[_s]].location>>
            <<set $farm_assault.teams[_assault_keys[_s]].location to "done">>
        <</if>>
    <</for>>
<<elseif $enemyhealth lte 0>>
    "Shit," the <<person1>><<person>> says. "Bailey's not gonna be happy."
	<<if $enemyno gte 2>>
        <span class="green">Bailey's thugs flee the field,</span> disappearing into the night.
    <<else>>
        <span class="green"><<He>> flees the field,</span> disappearing into the night.
    <</if>>
	<br><br>
	<<tearful>> you plan your next move.
	<br><br>
	<<clotheson>>
	<<endcombat>>
	<<link [[Next|Farm Assault]]>><</link>>
    <br>
    <<set _assault_keys to Object.keys($farm_assault.teams)>>
    <<for _s to 0; _s lt _assault_keys.length; _s++>>
        <<if $bus is $farm_assault.teams[_assault_keys[_s]].location>>
            <<set $farm_assault.teams[_assault_keys[_s]].location to "done">>
        <</if>>
    <</for>>

<<else>>
	You fall to the earth, too hurt to continue fighting.
	<br><br>
	The <<person1>><<person>> crouches over you. "Sorry kid," <<he>> says. "But this is the way of the world."
	<br><br>
    You can't stop <<him>> binding your arms and legs together, and tying a gag around your mouth. "Later <<girl>>."
    <br><br>
    <<tearful>> you struggle against the rope. It was a rough job, and you should be able to work free.
    <br><br>
	<<endcombat>>
    <<set $farm_assault.bindings to 3>>
    <<bind>>
    <<facewear 4>>
	<<link [[Next|Farm Assault]]>><</link>>
    <br>
    
<</if>>


:: Farm Assault Pick Bailey
<<effects>>


<<set _assault_keys to Object.keys($farm_assault.teams)>>
<<for _s to 0; _s lt _assault_keys.length; _s++>>
    <<if $bus is $farm_assault.teams[_assault_keys[_s]].location>>

        <<if $farm_assault.teams[_assault_keys[_s]].number gte 2>>
            You keep to the shadows as you stalk the intruders, waiting for an opening.
        <<else>>
            You keep to the shadows as you stalk the intruder, waiting for an opening.
        <</if>>
        <br><br>

        <<skulduggerycheck>>
        <<if $skulduggerysuccess is 1>>

            <<if $farm_assault.teams[_assault_keys[_s]].number gte 2>>
                <span class="green">You find one.</span> A <<generate1>><<person1>><<person>> strays too far from <<his>> fellows. You lunge from the dark, and smack <<him>> over the head. <<His>> body slumps to the earth, unconscious.
                <br><br>
                <<endevent>>
                <<set $farm_assault.teams[_assault_keys[_s]].number -= 1>>
            <<else>>
                <span class="green">You find one.</span> The <<generate1>><<person1>><<person>> stands too close to a hedge, letting you sneak right behind <<him>>. You lunge from the dark, and smack <<him>> over the head. <<His>> body slumps to the earth, unconscious.
                <br><br>
                <<endevent>>
                <<set $farm_assault.teams[_assault_keys[_s]].number -= 1>>
            <</if>>
            <br><br>

            <<if $skulduggery lte ($skulduggerydifficulty + 100)>>
                <<skulduggeryskilluse>>
            <<else>>
                <span class="blue">That was too easy. You didn't learn anything.</span>
                <br><br>
            <</if>>

            <<link [[Next|Farm Assault]]>><<endevent>><</link>>
           <br>

        <<else>>


            <<if $farm_assault.teams[_assault_keys[_s]].number gte 2>>
                <<if $farm_assault.teams[_assault_keys[_s]].number gte 3>>
                    <<generate1>><<generate2>><<generate3>>
                <<else>>
                    <<generate1>><<generate2>>
                <</if>>
                A <<person1>><<person>> strays apart from the others, and you make your move, sneaking closer. You lunge from the dark, <span class="red">but the <<person>> spins and catches your arm.</span>
                <br><br>
                "Found the <<girl>>," <<he>> says as <<he>> shunts you away. You hear footsteps from behind.
                <br><br>
            <<else>>
                You keep to the shadows as you stalk the intruder, waiting for an opening.
            <</if>>

            <<link [[Next|Farm Assault Fight Bailey]]>><<set $fightstart to 1>><</link>>
            <br>

        <</if>>
    <</if>>
<</for>>

:: Farm Assault Pick
<<effects>>



<<set _assault_keys to Object.keys($farm_assault.teams)>>
<<for _s to 0; _s lt _assault_keys.length; _s++>>
    <<if $bus is $farm_assault.teams[_assault_keys[_s]].location>>

        <<if $farm_assault.teams[_assault_keys[_s]].number gte 2>>
            You keep to the shadows as you stalk the intruders, waiting for an opening.
        <<else>>
            You keep to the shadows as you stalk the intruder, waiting for an opening.
        <</if>>
        <br><br>

        <<skulduggerycheck>>
        <<if $skulduggerysuccess is 1>>

            <<if $farm_assault.teams[_assault_keys[_s]].number gte 2>>
                <span class="green">You find one.</span> A <<generate1>><<person1>><<person>> strays too far from <<his>> fellows. You lunge from the dark, and smack <<him>> over the head. <<His>> body slumps to the earth, unconscious.
                <br><br>
                <<endevent>>
                <<set $farm_assault.teams[_assault_keys[_s]].number -= 1>>
            <<else>>
                <span class="green">You find one.</span> The <<generate1>><<person1>><<person>> stands too close to a hedge, letting you sneak right behind <<him>>. You lunge from the dark, and smack <<him>> over the head. <<His>> body slumps to the earth, unconscious.
                <br><br>
                <<endevent>>
                <<set $farm_assault.teams[_assault_keys[_s]].number -= 1>>
            <</if>>
            <br><br>

            <<if $skulduggery lte ($skulduggerydifficulty + 100)>>
                <<skulduggeryskilluse>>
            <<else>>
                <span class="blue">That was too easy. You didn't learn anything.</span>
                <br><br>
            <</if>>

            <<link [[Next|Farm Assault]]>><<endevent>><</link>>
            <br>

        <<else>>

            <<if $farm_assault.teams[_assault_keys[_s]].number gte 2>>
                <<if $farm_assault.teams[_assault_keys[_s]].number gte 3>>
                    <<generate1>>
                <<else>>
                    <<generate1>>
                <</if>>
                <span class="red">You can't find one.</span> The thugs stay too close together. Attacking one would alert the others.
                <br><br>

                <<link [[Next|Farm Assault]]>><<endevent>><</link>>
                <br>
            <<else>>
                <<generate1>><<person1>>
                You keep to the shadows as you stalk the intruder, a <<person>>, waiting for an opening. You creep up while <<his>> back is turned, <span class="red">but trip in the dark,</span> stumbling to the ground and alerting <<him>>.
                <br><br>

                <<He>> turns and plants <<his>> feet, though you're not sure <<he>> knows quite where you are.
                <br><br>

                <<link [[Fight|Farm Assault Fight]]>><<set $fightstart to 1>><</link>>
                <br>
                <<link [[Flee|Farm Assault Flight]]>><</link>>
                <br>
            <</if>>
        <</if>>
    <</if>>
<</for>>


:: Farm Assault Flight
<<effects>>

You turn and flee into the darkness.
<br><br>

<<link [[Next|Farm Assault]]>><<endevent>><</link>>
<br>


:: Farm Assault Pick Alex
<<effects>>
You and Alex stalk the intruders, waiting for one to stray too close to the dark.
<<set _assault_keys to Object.keys($farm_assault.teams)>>
<<for _s to 0; _s lt _assault_keys.length; _s++>>
    <<if $bus is $farm_assault.teams[_assault_keys[_s]].location>>
        <<if $farm_assault.teams[_assault_keys[_s]].type is "bailey">>
            <<generate1>><<person1>>
            One, a <<person>>, stands with <<his>> back to a hedge, seeming to think it impenetrable.
            <br><br>
            You emerge from the undergrowth to strike, but the <<person>> spins and grasps your arm. <<He>> doesn't notice Alex until it's too late. One blow lays <<him>> on the ground.
            <br><br>
            Alex resists the urge to cheer.
            <br><br>
            <<link [[Next|Farm Assault]]>><<endevent>><</link>>
            <br>
        <<else>>
            They don't seem like they'll play along, until Alex emerges into the light, and taunts them, before vanishing into tall grass.
            <br><br>
            <<generate1>><<person1>>
            <<if $farm_assault.teams[_assault_keys[_s]].number gte 3>>
                Two rush after, leaving a <<person>> behind. 
            <<else>>
                One rushes after, leaving a <<person>> behind. 
            <</if>>
            Now's your chance. You creep behind <<him>>, and strike. <<He>> doesn't utter a sound as <<he>> falls.
            <br><br>
            You regroup with Alex, and plot your next move.
            <br><br>

            <<link [[Next|Farm Assault]]>><<endevent>><</link>>
            <br>
        <</if>>
        <<set $farm_assault.teams[_assault_keys[_s]].number -= 1>>
    <</if>>
<</for>>

:: Farm Assault Charge
<<effects>>

You charge the intruders, Alex at your side.
<<set _assault_keys to Object.keys($farm_assault.teams)>>
<<for _s to 0; _s lt _assault_keys.length; _s++>>
    <<if $bus is $farm_assault.teams[_assault_keys[_s]].location>>
        <<if $farm_assault.teams[_assault_keys[_s]].number gte 3>>
            <<generate1>><<generate2>><<person1>>
            There are three of them. One splits off to intercept Alex, leaving the <<person>> and <<person2>><<person>> to you.
            <br><br>
            <<person1>>
        <<else>>
            <<generate1>><<person1>>
            There are two of them. One intercepts Alex, leaving the <<person>> to you.
            <br><br>
        <</if>>
        <<if $farm_assault.teams[_assault_keys[_s]].type is "bailey">>

            <<link [[Next|Farm Assault Alex Fight Bailey]]>><<set $fightstart to 1>><</link>>
            <br>
        <<else>>
            <<link [[Next|Farm Assault Alex Fight]]>><<set $fightstart to 1>><</link>>
            <br>
        <</if>>
    <</if>>
<</for>>

:: Farm Assault Overpower
<<effects>>

<<generate1>><<person1>>You rush the lone intruder, a <<person>>, while Alex circles around.
<<set _assault_keys to Object.keys($farm_assault.teams)>>
<<for _s to 0; _s lt _assault_keys.length; _s++>>
    <<if $bus is $farm_assault.teams[_assault_keys[_s]].location>>
        <<if $farm_assault.teams[_assault_keys[_s]].type is "bailey">>
            <<He>> turns to face you, planting <<his>> feet. Alex rushes <<him>> from behind. The <<person>> swivels and deflects the blow with <<his>> arms, but this leaves <<him>> open to you. You whack <<him>> over the head, and <<he>> slumps to the ground.<<glove>><<npcincr Alex love 1>>
            <br><br>

            <<link [[Next|Farm Assault]]>><<endevent>><</link>>
            <br>
        <<else>>
            <<He>> turns to face you, planting <<his>> feet. <<He>> notices Alex too late. <<He>> slumps to the ground.<<glove>><<npcincr Alex love 1>>
            <br><br>
            <<link [[Next|Farm Assault]]>><<endevent>><</link>>
            <br>
        <</if>>
        <<set $farm_assault.teams[_assault_keys[_s]].location to "done">>
    <</if>>
<</for>>

:: Farm Assault Alex Fight
<<if $fightstart is 1>>
	<<set $fightstart to 0>>

	<<neutral 1>>

	<<maninit>>
	<<set $enemytrust -= 100>>
	<<set $enemyanger += 200>>
	<<npcidlegenitals>>
    
<</if>>

You hear Alex fighting the other intruder.
<br><br>

<<effects>>
<<effectsman>><<man>>

<<stateman>>
<br><br>
<<actionsman>>

<<if $enemyhealth lte 0>>
	<span id="next"><<link [[Next|Farm Assault Alex Fight Finish]]>><</link>></span><<nexttext>>
<<elseif $enemyarousal gte $enemyarousalmax>>
	<span id="next"><<link [[Next|Farm Assault Alex Fight Finish]]>><</link>></span><<nexttext>>
<<elseif $pain gte 100 and $willpowerpain is 0>>
	<span id="next"><<link [[Next|Farm Assault Alex Fight Finish]]>><</link>></span><<nexttext>>
<<else>>
	<span id="next"><<link [[Next|Farm Assault Alex Fight]]>><</link>></span><<nexttext>>
<</if>>

:: Farm Assault Alex Fight Finish
<<effects>>
<<if $enemyarousal gte $enemyarousalmax>>
	<<ejaculation>>
    <<if $enemyno gte 2>>
        Remy's thugs are too dazed and exhausted to continue. <span class="green">They stagger from the field.</span>
    <<else>>
        The <<person1>><<person>> is too dazed and exhausted to continue. <span class="green"><<He>> staggers from the field.</span>
    <</if>>
    <br><br>
	
	<<clotheson>>
	<<endcombat>>
    <<npc Alex>><<person1>>
    <<tearful>> you rush to Alex' aid. You arrive in time to see <<him>> drive the intruder away. <<He>> turns to you, sweaty and triumphant. "We showed em." You don't think <<he>> realises how you subdued yours.
	<br><br>
	<<link [[Next|Farm Assault]]>><<endevent>><</link>>
    <br>
    <<set _assault_keys to Object.keys($farm_assault.teams)>>
    <<for _s to 0; _s lt _assault_keys.length; _s++>>
        <<if $bus is $farm_assault.teams[_assault_keys[_s]].location>>
            <<set $farm_assault.teams[_assault_keys[_s]].location to "done">>
        <</if>>
    <</for>>
<<elseif $enemyhealth lte 0>>
	<<if $enemyno gte 2>>
        <span class="green">Remy's thugs flee the field,</span> throwing worried glances over their shoulders to make sure you're not pursuing.
    <<else>>
        <span class="green">The <<person1>><<person>> flees the field,</span> throwing worried glances over <<his>> shoulder to make sure you're not pursing.
    <</if>>
	<br><br>
	<<clotheson>>
	<<endcombat>>
    <<npc Alex>><<person1>>
    <<tearful>> you rush to Alex's aid. You arrive in time to see <<him>> drive the intruder away. <<He>> turns to you, sweaty and triumphant. "We showed em. No time to rest. Let's go."
    <br><br>
	<<link [[Next|Farm Assault]]>><<endevent>><</link>>
    <br>
    
    <<set _assault_keys to Object.keys($farm_assault.teams)>>
    <<for _s to 0; _s lt _assault_keys.length; _s++>>
        <<if $bus is $farm_assault.teams[_assault_keys[_s]].location>>
            <<set $farm_assault.teams[_assault_keys[_s]].location to "done">>
        <</if>>
    <</for>>
<<else>>
	You fall to the earth, too hurt to continue fighting.
	<br><br>
	The <<person1>><<person>> crouches over you, <span class="purple">and gropes your <<breasts>></span>. "Shame I got a job to do," <<he>> says. <<He>> produces a length of rope.<<gstress>><<stress 6>>
    <br><br>
	
    "Leave <<phim>> alone!" shouts Alex, rushing over and leaving the other intruder slumped in the mud.
    <br><br>
    Alex slams into the <<person>> before <<he>> can rise, and helps you to your feet. <<tearful>> you limp away, supported by Alex at your side.
    <<endcombat>>
    <<clotheson>>
    <<npc Alex>><<person1>>
    "That was too dangerous," Alex says once safely hidden away. The intruders don't pursue, perhaps concerned with their own injured. "You can sit out if you need to," <<he>> says. "I've got this."<<ggdom>><<npcincr Alex dom 1>>
    <br><br>
    
	<<link [[Next|Farm Assault]]>><<endevent>><</link>>
    <br>
    <<set _assault_keys to Object.keys($farm_assault.teams)>>
    <<for _s to 0; _s lt _assault_keys.length; _s++>>
        <<if $bus is $farm_assault.teams[_assault_keys[_s]].location>>
            <<set $farm_assault.teams[_assault_keys[_s]].number -= 1>>
        <</if>>
    <</for>>
<</if>>

:: Farm Assault Alex Fight Bailey
<<if $fightstart is 1>>
	<<set $fightstart to 0>>

	<<neutral 1>>

	<<maninit>>
	<<set $enemytrust -= 100>>
	<<set $enemyanger += 200>>
	<<npcidlegenitals>>
    <<set $enemyhealthmax *= 1.3>>
    <<set $enemyhealth *= 1.3>>
    <<set $enemyarousalmax *= 1.3>>
<</if>>

You hear Alex fighting the other intruder.
<br><br>

<<effects>>
<<effectsman>><<man>>

<<stateman>>
<br><br>
<<actionsman>>

<<if $enemyhealth lte 0>>
	<span id="next"><<link [[Next|Farm Assault Alex Fight Bailey Finish]]>><</link>></span><<nexttext>>
<<elseif $enemyarousal gte $enemyarousalmax>>
	<span id="next"><<link [[Next|Farm Assault Alex Fight Bailey Finish]]>><</link>></span><<nexttext>>
<<elseif $pain gte 100 and $willpowerpain is 0>>
	<span id="next"><<link [[Next|Farm Assault Alex Fight Bailey Finish]]>><</link>></span><<nexttext>>
<<else>>
	<span id="next"><<link [[Next|Farm Assault Alex Fight Bailey]]>><</link>></span><<nexttext>>
<</if>>

:: Farm Assault Alex Fight Bailey Finish
<<effects>>
<<if $enemyarousal gte $enemyarousalmax>>
	<<ejaculation>>
    "You'll go far," the <<person1>><<person>> mutters.
    <<if $enemyno gte 2>>
        Bailey's thugs are too dazed and exhausted to continue, <span class="green">and stagger from the field.</span>
    <<else>>
        <<Hes>> too dazed and exhausted to continue, <span class="green">and staggers from the field.</span>
    <</if>>
    <br><br>

    <<endcombat>>
    <<clotheson>>
    <<npc Alex>><<person1>><<generate2>>
	<<tearful>> you rush to Alex's side. You find <<him>> wrestling with the remaining intruder, a <<person2>><<person>>. The intruder has the upper hand, until you smack <<him>> over the head from behind.<<person1>><<npcincr Alex dom 1>>
    <br><br>
	"You showed em," Alex says as you help <<him>> to <<his>> feet. You don't think <<he>> realises how you subdued yours.
    <br><br>
	<<link [[Next|Farm Assault]]>><<endevent>><</link>>
    <br>
    <<set _assault_keys to Object.keys($farm_assault.teams)>>
    <<for _s to 0; _s lt _assault_keys.length; _s++>>
        <<if $bus is $farm_assault.teams[_assault_keys[_s]].location>>
            <<set $farm_assault.teams[_assault_keys[_s]].location to "done">>
        <</if>>
    <</for>>
<<elseif $enemyhealth lte 0>>
    "Shit," the <<person1>><<person>> says. "Bailey's not gonna be happy."
	<<if $enemyno gte 2>>
        <span class="green">Bailey's thugs flee the field,</span> disappearing into the night.
    <<else>>
        <span class="green"><<He>> flees the field,</span> disappearing into the night.
    <</if>>
	<br><br>
    <<endcombat>>
    <<clotheson>>
    <<npc Alex>><<person1>>
	<<tearful>> you rush to Alex's side. You find <<him>> wrestling with the remaining intruder, a <<person2>><<person>>. The intruder has the upper hand, until you smack <<him>> over the head from behind.<<person1>><<npcincr Alex dom 1>>
    <br><br>
	"You showed em," Alex says as you help <<him>> to <<his>> feet.
    <br><br>
	<<link [[Next|Farm Assault]]>><<endevent>><</link>>
    <br>
    
    <<set _assault_keys to Object.keys($farm_assault.teams)>>
    <<for _s to 0; _s lt _assault_keys.length; _s++>>
        <<if $bus is $farm_assault.teams[_assault_keys[_s]].location>>
            <<set $farm_assault.teams[_assault_keys[_s]].location to "done">>
        <</if>>
    <</for>>
<<else>>
	You fall to the earth, too hurt to continue fighting.
	<br><br>
	The <<person1>><<person>> crouches over you. "Sorry kid," <<he>> says. "But this is the way of the world." <<He>> produces a length of rope, and a gag.
	<br><br>
    <<endcombat>>
    <<npc Alex>><<person1>><<generate2>>
    "Don't you dare!" shouts Alex. <<He>> runs closer, but a <<person2>><<person>> tackles <<person1>><<him>> from behind.
    <br><br>
    "Your friend is spirited. Not a problem. Always bring plenty of rope." You can't stop them binding your arms and legs together, and tying a gag around your mouth. You hear Alex's muffled voice nearby. "Later <<girl>>."
    <br><br>
    <<tearful>> you struggle against the rope. It was a rough job, and you should be able to work free.
    <br><br>
	<<endevent>>
    <<set $farm_assault.bindings to 3>>
    <<set $farm_assault.bindings_alex to 3>>
    <<bind>>
    <<facewear 4>>
	<<link [[Next|Farm Assault]]>><</link>>
    <br>
    
<</if>>


:: Farm Assault Tower Defend
<<effects>>

You arrive at the base of the tower. You already hear a struggle at the top. The stairs creak as you climb.
<br><br>
<<set _assault_keys to Object.keys($farm_assault.teams)>>
<<for _s to 0; _s lt _assault_keys.length; _s++>>
    <<if $bus is $farm_assault.teams[_assault_keys[_s]].location>>
        You emerge to find <<farm_assault_thugs>> besetting $farm.tower_guard.
        <<endevent>>
        <<loadNPC 0 "farm_tower_guard">><<person1>>
        
        <<if $NPCList[0].traits.includes("relaxed")>>
            "Come on," <<he>> says, backed into a corner, but defiant. "Make it count."
        <<elseif $NPCList[0].traits.includes("sociable")>>
            "I've handled worse than you lot," <<he>> says. "Bring it. See what happens."
        <<elseif $NPCList[0].traits.includes("brooding")>>
            "Time to earn my pay," <<he>> spits.
        <<else>>
            "I'm popular tonight," <<he>> laughs. "Everyone wants a dance." 
        <</if>>
        <<endevent>>
        <br><br>
        <<if $farm_assault.teams[_assault_keys[_s]].type is "bailey">>
            <<if $farm_assault.teams[_assault_keys[_s]].number gte 3>>
                <<generate1>><<generate2>><<person1>><<set $skulduggerydifficulty to 1200>>
                The three thugs step closer, wary. They haven't noticed you.
            <<elseif $farm_assault.teams[_assault_keys[_s]].number gte 2>>
                <<generate1>><<person1>><<set $skulduggerydifficulty to 1000>>
                The three thugs step closer, wary. They haven't noticed you.
            <<else>>
                <<generate1>><<person1>><<set $skulduggerydifficulty to 600>>
                The thug, a <<person>>, steps closer, wary. <<He>> hasn't noticed you.
            <</if>>
            <br><br>
            <<if $skulduggerydifficulty gte 1>>
                <<link [[Charge|Farm Assault Charge Bailey]]>><</link>>
                <br>
            <</if>>
            <<link [[Sneak up|Farm Assault Sneak Bailey]]>><</link>><<skulduggerydifficulty>>
            <br>
        <<else>>
            <<if $farm_assault.teams[_assault_keys[_s]].number gte 3>>
                <<generate1>><<generate2>><<person1>><<set $skulduggerydifficulty to 800>>
                The three thugs walk closer, smiling and unthreatened. They haven't noticed you.
            <<elseif $farm_assault.teams[_assault_keys[_s]].number gte 2>><<set $skulduggerydifficulty to 600>>
                <<generate1>><<person1>>
                The three thugs step closer, seeming unthreatened. They haven't noticed you.
            <<else>><<set $skulduggerydifficulty to 0>>
                <<generate1>><<person1>>
                The thug, a <<person>>, steps closer, wary. <<He>> hasn't noticed you.
            <</if>>
            <br><br>
            <<if $skulduggerydifficulty gte 1>>
                <<link [[Charge|Farm Assault Charge]]>><</link>>
                <br>
            <</if>>
            <<link [[Sneak up|Farm Assault Sneak]]>><</link>><<skulduggerydifficulty>>
            <br>
        <</if>>
    <</if>>
<</for>>

<<link [[Climb down|Farm Assault]]>><<endevent>><</link>>
<br>

:: Farm Assualt Charge
<<effects>>

You charge the thugs. They spin to face you, giving $farm.tower_guard an opening.
<br><br>

<<link [[Next|Farm Assault Tower Fight]]>><<set $fightstart to 1>><</link>>
<br>


:: Farm Assault Tower Fight
<<effects>>
<<if $fightstart is 1>>
	<<set $fightstart to 0>>

	<<neutral 1>>

	<<maninit>>
	<<set $enemytrust -= 100>>
	<<set $enemyanger += 200>>
	<<npcidlegenitals>>

<</if>>

$farm.tower_guard fights nearby.
<br><br>

<<effects>>
<<effectsman>><<man>>

<<stateman>>
<br><br>
<<actionsman>>

<<if $enemyhealth lte 0>>
	<span id="next"><<link [[Next|Farm Assault Tower Fight Finish]]>><</link>></span><<nexttext>>
<<elseif $enemyarousal gte $enemyarousalmax>>
	<span id="next"><<link [[Next|Farm Assault Tower Fight Finish]]>><</link>></span><<nexttext>>
<<elseif $pain gte 100 and $willpowerpain is 0>>
	<span id="next"><<link [[Next|Farm Assault Tower Fight Finish]]>><</link>></span><<nexttext>>
<<else>>
	<span id="next"><<link [[Next|Farm Assault Tower Fight]]>><</link>></span><<nexttext>>
<</if>>

:: Farm Assault Tower Fight Finish
<<effects>>
<<if $enemyarousal gte $enemyarousalmax>>
	<<ejaculation>>
	<<if $enemyno gte 2>>
        The thugs stagger away from you. They need a breather, but look ready to continue fighting. Until $farm.tower_guard sends <<his>> colleague plummeting from the tower. They turn and run down the stairs.
    <<else>>
        <<He>> staggers away from you. <<He>> needs a breather, but looks ready to continue fighting. Until $farm.tower_guard sends <<his>> colleague plummeting from the tower. <<He>> turns and runs down the stairs.
    <</if>>
	<br><br>
	<<tearful>> you rest against the railing.
	<br><br>
	<<clotheson>>
	<<endcombat>>

    <<loadNPC 0 "farm_tower_guard">><<person1>>
    <<if $NPCList[0].traits.includes("relaxed")>>
        "That's a strange way to fight," $farm.tower_guard says. "If it works, it works.
    <<elseif $NPCList[0].traits.includes("sociable")>>
        "I've some friends who want to get into sex work," $farm.tower_guard says. "They could learn from you."
    <<elseif $NPCList[0].traits.includes("brooding")>>
        "That's one way to do it," $farm.tower_guard. "I don't judge. We survive the way we can."
    <<else>>
        "Wish you gave me that treatment," $farm.tower_guard laughs. 
    <</if>>
    <<gstress>><<stress 6>>
    <<endevent>>
    <br><br>
	<<link [[Next|Farm Assault]]>><</link>>
    <br>

    <<set _assault_keys to Object.keys($farm_assault.teams)>>
    <<for _s to 0; _s lt _assault_keys.length; _s++>>
        <<if $bus is $farm_assault.teams[_assault_keys[_s]].location>>
            <<set $farm_assault.teams[_assault_keys[_s]].location to "done">>
        <</if>>
    <</for>>
    <<set $farm_assault.tower to "manned">>

<<elseif $enemyhealth lte 0>>
	<<if $enemyno gte 2>>
        You smack the <<person1>><<person>> from the tower. $farm.tower_guard's opponent follows suit. The <<person2>><<person>> turns and runs, almost falling down the stairs.
    <<else>>
        You smack the <<person1>><<person>> from the tower. $farm.tower_guard's opponent follows suit.
    <</if>>
	<br><br>
	<<tearful>> you rest on the railing.
	<br><br>
	<<clotheson>>
	<<endcombat>>

    <<loadNPC 0 "farm_tower_guard">><<person1>>
    <<if $NPCList[0].traits.includes("relaxed")>>
        "Couldn't end any other way," $farm.tower_guard laughs. "We'll send the next ones packing too."
    <<elseif $NPCList[0].traits.includes("sociable")>>
        "That was almost fun," $farm.tower_guard laughs. "Maybe next time we'll break a sweat."
    <<elseif $NPCList[0].traits.includes("brooding")>>
        "Job done, but there might be more coming," $farm.tower_guard says. "Thanks for the assist."
    <<else>>
        $farm.tower_guard holds out <<his>> hand for a high hive. "We showed em," <<he>> says. "Maybe you'll reward me later? A <<if $pronoun is "m">>boy<<else>>girl<</if>> can dream."" 
    <</if>>
    <br><br>
    <<endevent>>

	<<link [[Next|Farm Assault]]>><</link>>
    <br>

    <<set _assault_keys to Object.keys($farm_assault.teams)>>
    <<for _s to 0; _s lt _assault_keys.length; _s++>>
        <<if $bus is $farm_assault.teams[_assault_keys[_s]].location>>
            <<set $farm_assault.teams[_assault_keys[_s]].location to "done">>
        <</if>>
    <</for>>
    <<set $farm_assault.tower to "manned">>

<<else>>
	You fall against the railing, too hurt to continue fighting.
    <<if $enemyno gte 2>>
        The thugs turn their attention to $farm.tower_guard, and rush to their colleague's aid.
    <<else>>
        The <<person1>><<person>> turns <<his>> attention to $farm.tower_guard, and rushes to <<his>> colleague's aid.
    <</if>>
	<br><br>
    <<endcombat>>

    <<loadNPC 0 "farm_tower_guard">><<person1>>
    <<set _assault_keys to Object.keys($farm_assault.teams)>>
    <<for _s to 0; _s lt _assault_keys.length; _s++>>
        <<if $bus is $farm_assault.teams[_assault_keys[_s]].location>>
            There's a struggle, until 
            <<if $farm.tower_guard_skill gte random(1, ($farm_assault.teams[_assault_keys[_s]].number * 500))>>
                $farm.tower_guard <span class="green">punches one assailant off the tower.</span>
                <<if $farm_assault.teams[_assault_keys[_s]].number gte 3>>
                    The other thugs turn and flee down the stairs.
                <<else>>
                    The other thug turns and flees down the stairs.
                <</if>>
                <br><br>
                $farm.tower_guard helps you to your feet.

                <<if $NPCList[0].traits.includes("relaxed")>>
                    "You alright?" <<he>> asks. "Sit the rest of this out if you need to. I'll keep Alex up to speed."
                <<elseif $NPCList[0].traits.includes("sociable")>>
                    "Take it easy for a bit," <<he>> says. "Hope the others haven't gotten up to much mischief while I've been distracted."
                <<elseif $NPCList[0].traits.includes("brooding")>>
                    "Don't take so many risks," <<he>> says. "Pace yourself."
                <<else>>
                    "You don't look so good," <<he>> says. "Good thing there are no perverts around to take advantage. Except me, but I'm on your payroll."
                <</if>>
                <br><br>
                <<tearful>> you climb down the stairs.
                <br><br>
                <<set $farm_assault.tower to "manned">>
                <<set $farm_assault.teams[_assault_keys[_s]].location to "done">>
            <<else>>
                <<farm_assualt_thugs>> <span class="red">overpower $farm.tower_guard, and knock <<him>> from the tower.</span> They cheer before rushing down the stairs, paying you no heed.
                <br><br>

                <<tearful>> you climb to your feet, then down the tower.
                <br><br>
                <<set $farm_assault.teams[_assault_keys[_s]].location to $farm_assault.no.pluck()>>
                <<set $farm_assault.teams[_assault_keys[_s]].state to "field">>
                <<set $farm_assault.tower to "defeated">>
            <</if>>
        <</if>>
    <</for>>

	<<clotheson>>
	
	<<link [[Next|Farm Assault]]>><<endevent>><</link>>
    <br>

<</if>>


:: Farm Assault Charge Bailey
<<effects>>

You charge the thugs. They spin to face you, giving $farm.tower_guard an opening.
<br><br>

<<link [[Next|Farm Assault Tower Bailey Fight]]>><<set $fightstart to 1>><</link>>
<br>

:: Farm Assault Tower Bailey Fight
<<effects>>
<<if $fightstart is 1>>
	<<set $fightstart to 0>>

	<<neutral 1>>

	<<maninit>>
	<<set $enemytrust -= 100>>
	<<set $enemyanger += 200>>
	<<npcidlegenitals>>
    
    <<set $enemyhealthmax *= 1.3>>
    <<set $enemyhealth *= 1.3>>
    <<set $enemyarousalmax *= 1.3>>
<</if>>

$farm.tower_guard fights nearby.
<br><br>

<<effects>>
<<effectsman>><<man>>

<<stateman>>
<br><br>
<<actionsman>>

<<if $enemyhealth lte 0>>
	<span id="next"><<link [[Next|Farm Assault Tower Bailey Fight Finish]]>><</link>></span><<nexttext>>
<<elseif $enemyarousal gte $enemyarousalmax>>
	<span id="next"><<link [[Next|Farm Assault Tower Bailey Fight Finish]]>><</link>></span><<nexttext>>
<<elseif $pain gte 100 and $willpowerpain is 0>>
	<span id="next"><<link [[Next|Farm Assault Tower Bailey Fight Finish]]>><</link>></span><<nexttext>>
<<else>>
	<span id="next"><<link [[Next|Farm Assault Tower Bailey Fight]]>><</link>></span><<nexttext>>
<</if>>

:: Farm Assault Tower Bailey Fight Finish
<<effects>>
<<if $enemyarousal gte $enemyarousalmax>>
	<<ejaculation>>
	<<if $enemyno gte 2>>
        The thugs stagger away from you. They need a breather, but look ready to continue fighting. Until $farm.tower_guard sends <<his>> colleague plummeting from the tower. They turn and run down the stairs.
    <<else>>
        <<He>> staggers away from you. <<He>> needs a breather, but looks ready to continue fighting. Until $farm.tower_guard sends <<his>> colleague plummeting from the tower. <<He>> turns and runs down the stairs.
    <</if>>
	<br><br>
	<<tearful>> you rest against the railing.
	<br><br>
	<<clotheson>>
	<<endcombat>>

    <<loadNPC 0 "farm_tower_guard">><<person1>>
    <<if $NPCList[0].traits.includes("relaxed")>>
        "That's a strange way to fight," $farm.tower_guard says. "If it works, it works.
    <<elseif $NPCList[0].traits.includes("sociable")>>
        "I've some friends who want to get into sex work," $farm.tower_guard says. "They could learn from you."
    <<elseif $NPCList[0].traits.includes("brooding")>>
        "That's one way to do it," $farm.tower_guard. "I don't judge. We survive the way we can."
    <<else>>
        "Wish you gave me that treatment," $farm.tower_guard laughs. 
    <</if>>
    <<gstress>><<stress 6>>
    <<endevent>>
    <br><br>
	<<link [[Next|Farm Assault]]>><</link>>
    <br>

    <<set _assault_keys to Object.keys($farm_assault.teams)>>
    <<for _s to 0; _s lt _assault_keys.length; _s++>>
        <<if $bus is $farm_assault.teams[_assault_keys[_s]].location>>
            <<set $farm_assault.teams[_assault_keys[_s]].location to "done">>
        <</if>>
    <</for>>
    <<set $farm_assault.tower to "manned">>

<<elseif $enemyhealth lte 0>>
	<<if $enemyno gte 2>>
        You smack the <<person1>><<person>> from the tower. $farm.tower_guard's opponent follows suit. The <<person2>><<person>> smirks, before turning and running down the stairs.
    <<else>>
        You smack the <<person1>><<person>> from the tower. $farm.tower_guard's opponent follows suit.
    <</if>>
	<br><br>
	<<tearful>> you rest on the railing.
	<br><br>
	<<clotheson>>
	<<endcombat>>

    <<loadNPC 0 "farm_tower_guard">><<person1>>
    <<if $NPCList[0].traits.includes("relaxed")>>
        "Couldn't end any other way," $farm.tower_guard laughs. "We'll send the next ones packing too."
    <<elseif $NPCList[0].traits.includes("sociable")>>
        "That was almost fun," $farm.tower_guard laughs. "Maybe next time we'll break a sweat."
    <<elseif $NPCList[0].traits.includes("brooding")>>
        "Job done, but there might be more coming," $farm.tower_guard says. "Thanks for the assist."
    <<else>>
        $farm.tower_guard holds out <<his>> hand for a high hive. "We showed em," <<he>> says. "Maybe you'll reward me later? A <<if $pronoun is "m">>boy<<else>>girl<</if>> can dream."" 
    <</if>>
    <br><br>
    <<endevent>>

	<<link [[Next|Farm Assault]]>><</link>>
    <br>

    <<set _assault_keys to Object.keys($farm_assault.teams)>>
    <<for _s to 0; _s lt _assault_keys.length; _s++>>
        <<if $bus is $farm_assault.teams[_assault_keys[_s]].location>>
            <<set $farm_assault.teams[_assault_keys[_s]].location to "done">>
        <</if>>
    <</for>>
    <<set $farm_assault.tower to "manned">>

<<else>>
	You fall against the railing, too hurt to continue fighting.
    <<if $enemyno gte 2>>
        The thugs turn their attention to $farm.tower_guard, and rush to their colleague's aid.
    <<else>>
        The <<person1>><<person>> turns <<his>> attention to $farm.tower_guard, and rushes to <<his>> colleague's aid.
    <</if>>
	<br><br>
    <<endcombat>>

    <<loadNPC 0 "farm_tower_guard">><<person1>>
    <<set _assault_keys to Object.keys($farm_assault.teams)>>
    <<for _s to 0; _s lt _assault_keys.length; _s++>>
        <<if $bus is $farm_assault.teams[_assault_keys[_s]].location>>
            There's a struggle, until 
            <<if $farm.tower_guard_skill gte random(1, ($farm_assault.teams[_assault_keys[_s]].number * 1000))>>
                $farm.tower_guard <span class="green">punches one assailant off the tower.</span>
                <<if $farm_assault.teams[_assault_keys[_s]].number gte 3>>
                    The other thugs laugh, then turn and flee down the stairs.
                <<else>>
                    The other thug laughs, then turns and flees down the stairs.
                <</if>>
                <br><br>
                $farm.tower_guard helps you to your feet.

                <<if $NPCList[0].traits.includes("relaxed")>>
                    "You alright?" <<he>> asks. "Sit the rest of this out if you need to. I'll keep Alex up to speed."
                <<elseif $NPCList[0].traits.includes("sociable")>>
                    "Take it easy for a bit," <<he>> says. "Hope the others haven't gotten up to much mischief while I've been distracted."
                <<elseif $NPCList[0].traits.includes("brooding")>>
                    "Don't take so many risks," <<he>> says. "Pace yourself."
                <<else>>
                    "You don't look so good," <<he>> says. "Good thing there are no perverts around to take advantage. Except me, but I'm on your payroll."
                <</if>>
                <br><br>
                <<tearful>> you climb down the stairs.
                <br><br>
                <<set $farm_assault.tower to "manned">>
                <<set $farm_assault.teams[_assault_keys[_s]].location to "done">>
            <<else>>
                <<farm_assualt_thugs>> <span class="red">overpower $farm.tower_guard, and knock <<him>> from the tower.</span> They cheer before rushing down the stairs, paying you no heed.
                <br><br>

                <<tearful>> you climb to your feet, then down the tower.
                <br><br>
                <<set $farm_assault.teams[_assault_keys[_s]].location to $farm_assault.no.pluck()>>
                <<set $farm_assault.teams[_assault_keys[_s]].state to "field">>
                <<set $farm_assault.tower to "defeated">>
            <</if>>
        <</if>>
    <</for>>

	<<clotheson>>
	
	<<link [[Next|Farm Assault]]>><<endevent>><</link>>
    <br>

<</if>>

:: Farm Assault Sneak
<<effects>>


You move as fast as you think you can get away with. $farm.tower_guard tries to keep the thugs' attention.
<br><br>

<<skulduggerycheck>>
<<if $skulduggerysuccess is 1>>

	<span class="green">You make it right up to a <<person>>, and shove.</span> <<He>> cries out in surprise as <<he>> flips over the railing, plummeting from the tower.
    <<if $enemyno gte 2>>
        <<His>> colleagues turn in surprise. $farm.tower_guard seizes the opening, and smacks a <<person2>><<person>> in the face. <<He>> staggers back, then trips and tumbles down the stairs.
        <br><br>
        
        The remaining thug runs after <<him>>.
        <br><br>
    <<else>>
        <<His>> colleague turns in surprise. $farm.tower_guard seizes the opening with a punch, and sends the remaining thug tumbling down the stairs.
        <br><br>
    <</if>>

	<<if $skulduggery lte ($skulduggerydifficulty + 100)>>
		<<skulduggeryskilluse>>
	<<else>>
		<span class="blue">That was too easy. You didn't learn anything.</span>
		<br><br>
	<</if>>
    <<endevent>>
    <<loadNPC 0 "farm_tower_guard">><<person1>>
    <<if $NPCList[0].traits.includes("relaxed")>>
        "You can think on your feet," $farm.tower_guard says. "I'm glad you were here."
    <<elseif $NPCList[0].traits.includes("sociable")>>
        "That's what you get," $farm.tower_guard shouts off the tower. <<He>> turns to you. "Thanks for the backup. I'll get back to spotting."
    <<elseif $NPCList[0].traits.includes("brooding")>>
        "Nice one," $farm.tower_guard says. "I'll get back to work."
    <<else>>
        "We make a good team," $farm.tower_guard says. "Maybe we'll team up in other ways later." <<He>> laughs."
    <</if>>    
    <br><br>

    <<link [[Next|Farm Assault]]>><<endevent>><</link>>
    <br>

    <<set _assault_keys to Object.keys($farm_assault.teams)>>
    <<for _s to 0; _s lt _assault_keys.length; _s++>>
        <<if $bus is $farm_assault.teams[_assault_keys[_s]].location>>
            <<set $farm_assault.teams[_assault_keys[_s]].location to "done">>
        <</if>>
    <</for>>
    <<set $farm_assault.tower to "manned">>

<<else>>

	<span class="red">The floorboards creak,</span> and the thugs swivel to face you. $farm.tower_guard capitalises on the distraction, and punches the closest.
	<br><br>

	<<if $skulduggery lte ($skulduggerydifficulty + 100)>>
		<<skulduggeryskilluse>>
	<<else>>
		<span class="blue">That was too easy. You didn't learn anything.</span>
		<br><br>
	<</if>>

	<<link [[Next|Farm Assault Tower Fight]]>><<set $fightstart to 1>><</link>>
    <br>

<</if>>

:: Farm Assault Sneak Bailey
<<effects>>

You move as fast as you think you can get away with. $farm.tower_guard tries to keep the thugs' attention.
<br><br>

<<skulduggerycheck>>
<<if $skulduggerysuccess is 1>>

	<span class="green">You make it right up to a <<person>>, and shove.</span> <<He>> cries out in surprise as <<he>> flips over the railing, plummeting from the tower.
    <<if $enemyno gte 2>>
        <<His>> colleagues turn in surprise. $farm.tower_guard seizes the opening, and smacks a <<person2>><<person>> in the face. <<He>> staggers back, then trips and tumbles down the stairs.
        <br><br>
        
        The remaining thug flashes you a smile, then runs after <<him>>.
        <br><br>
    <<else>>
        <<His>> colleague turns in surprise. $farm.tower_guard seizes the opening with a punch, and sends the remaining thug tumbling down the stairs.
        <br><br>
    <</if>>

	<<if $skulduggery lte ($skulduggerydifficulty + 100)>>
		<<skulduggeryskilluse>>
	<<else>>
		<span class="blue">That was too easy. You didn't learn anything.</span>
		<br><br>
	<</if>>
    <<endevent>>
    <<loadNPC 0 "farm_tower_guard">><<person1>>
    <<if $NPCList[0].traits.includes("relaxed")>>
        "You can think on your feet," $farm.tower_guard says. "I'm glad you were here."
    <<elseif $NPCList[0].traits.includes("sociable")>>
        "That's what you get," $farm.tower_guard shouts off the tower. <<He>> turns to you. "Thanks for the backup. I'll get back to spotting."
    <<elseif $NPCList[0].traits.includes("brooding")>>
        "Nice one," $farm.tower_guard says. "I'll get back to work."
    <<else>>
        "We make a good team," $farm.tower_guard says. "Maybe we'll team up in other ways later." <<He>> laughs."
    <</if>>    
    <br><br>

    <<link [[Next|Farm Assault]]>><<endevent>><</link>>
    <br>

    <<set _assault_keys to Object.keys($farm_assault.teams)>>
    <<for _s to 0; _s lt _assault_keys.length; _s++>>
        <<if $bus is $farm_assault.teams[_assault_keys[_s]].location>>
            <<set $farm_assault.teams[_assault_keys[_s]].location to "done">>
        <</if>>
    <</for>>
    <<set $farm_assault.tower to "manned">>

<<else>>

	<span class="red">The floorboards creak,</span> and the thugs swivel to face you. $farm.tower_guard capitalises on the distraction, and punches the closest.
	<br><br>

	<<if $skulduggery lte ($skulduggerydifficulty + 100)>>
		<<skulduggeryskilluse>>
	<<else>>
		<span class="blue">That was too easy. You didn't learn anything.</span>
		<br><br>
	<</if>>

	<<link [[Next|Farm Assault Tower Bailey Fight]]>><<set $fightstart to 1>><</link>>
    <br>

<</if>>


